var W=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var b=(e,t,r)=>(W(e,t,"read from private field"),r?r.call(e):t.get(e)),S=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},C=(e,t,r,n)=>(W(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r);var w=(e,t,r)=>(W(e,t,"access private method"),r);var R={select:"select-event",snapshot:"state-snapshot"},I={randomized:"randomized",priority:"priority",chaos:"chaos",custom:"custom"};var V=({bids:e,selectedEvent:t})=>{let r=[];for(let n of e){let{generator:o,waitFor:s,block:a,request:c,thread:i,priority:l,trigger:f}=n,M={thread:i,priority:l},h;if(s&&Object.assign(M,{waitFor:Array.isArray(s)?s:[s]}),a&&Object.assign(M,{block:Array.isArray(a)?a:[a]}),c){let g=Array.isArray(c)?c:[c];g.some(({event:u})=>u===t.event&&l===t.priority)&&(h=t.event),Object.assign(M,{request:g})}r.push({...M,...f&&{trigger:f},...h&&{selected:h}})}return r.sort((n,o)=>n.priority-o.priority)};var G=()=>{let e=[];function t(r){for(let n in e)e[n](r)}return t.subscribe=r=>{e.push(n=>{n!==void 0&&r(n)})},t};var me=e=>{for(let t=e.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e.sort(({priority:t},{priority:r})=>t-r)[0]},de=e=>e[Math.floor(Math.random()*Math.floor(e.length))],fe=e=>e.sort(({priority:t},{priority:r})=>t-r)[0],Z={[I.priority]:fe,[I.chaos]:de,[I.randomized]:me};var X=(...e)=>function*(){for(let t of e)yield*t()},J=(e,t=()=>!0)=>function*(){for(;t();)for(let r of e)yield*r()},Q=e=>function*(){yield e};var Y=({event:e,detail:t={}})=>({event:r,cb:n})=>n?n({detail:t,event:e}):e===r,j=({strategy:e=I.priority,dev:t}={})=>{let r=typeof e=="string"?Z[e]:e,n=new Set,o=new Set,s=G();function a(){o.size&&c()}function c(){for(let g of o){let{generator:u,priority:E,thread:T,trigger:x}=g,{value:d,done:P}=u.next();!P&&n.add({thread:T,priority:E,...x&&{trigger:x},generator:u,...d}),o.delete(g)}i()}function i(){let g=[...n],u=[];for(let{request:d,priority:P}of g){if(Array.isArray(d)){u=u.concat(d.map(k=>({priority:P,...k})));continue}d&&u.push({priority:P,...d})}let E=g.flatMap(({block:d})=>d||[]),T=u.filter(d=>!E.some(Y(d))),x=r(T);x&&(t&&s({type:R.snapshot,data:V({bids:g,selectedEvent:x})}),l(x))}function l(g){for(let x of n){let{request:d=[],waitFor:P=[],generator:k}=x;[...Array.isArray(d)?d:[d],...Array.isArray(P)?P:[P]].some(Y(g))&&k&&(o.add(x),n.delete(x))}let{priority:u,cb:E,...T}=g;s({type:R.select,data:T}),a()}let f=({event:g,detail:u})=>{let E=function*(){yield{request:[{event:g,detail:u}],waitFor:[{event:"",cb:()=>!0}]}};o.add({thread:g,priority:0,trigger:!0,generator:E()}),a()},M=g=>{s.subscribe(({type:u,data:E})=>{if(u===R.select){let{event:T,detail:x={}}=E;Object.hasOwn(g,T)&&g[T](x)}})},h=g=>{for(let u in g)o.add({thread:u,priority:o.size+1,generator:g[u]()})};return t&&s.subscribe(({type:g,data:u})=>{g===R.snapshot&&t(u)}),Object.freeze({addThreads:h,feedback:M,trigger:f,loop:J,sync:Q,thread:X})};var He=(...e)=>e.filter(Boolean).join(" ");var O=e=>Object.prototype.toString.call(e).slice(8,-1).toLowerCase();var he=/[&<>'"]/g;var ye={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"};var{replace:Te}="",ee=e=>Te.call(e,he,t=>ye[t]);var te=e=>{let t=[...e].reduce((r,n)=>(r<<5)+r+n.charCodeAt(0),5381);return t===5381?null:t};var ne=e=>{let t=/(^\w+|(?:\s)\w+)(?:->)/g;return[...e.matchAll(t)].flatMap(([,r])=>r)},se=({currentTarget:e,composedPath:t,type:r},n)=>{let o=e===n||t().find(i=>i instanceof HTMLSlotElement)===n?n:void 0;if(!o)return"";let s=`${r}->`,c=(o.dataset.trigger??"").trim().split(/\s+/).find(i=>i.includes(s));return c?c.replace(s,""):""},z=e=>!e.hasAttribute("slot")&&e.hasAttribute("name"),oe=e=>{let t=[];return e.forEach(r=>{if(r instanceof HTMLElement||r instanceof SVGElement){if(r instanceof HTMLSlotElement&&!z(r))return;r.dataset.trigger&&t.push(r)}}),t},A=e=>e.replace(/(\s\s+|\n)/g," "),re=e=>O(e)==="string"||O(e)==="number",H=(e,...t)=>{let{raw:r}=e,n=t.reduce((o,s,a)=>{o+=A(r[a]);let c=Array.isArray(s)?s.filter(re).join(""):re(s)?s:"";return o.endsWith("$")&&(c=ee(c),o=o.slice(0,-1)),o+c},"");return n+=A(r[r.length-1])};var xe=e=>{let t=/\.(-?[_a-zA-Z]+[_a-zA-Z0-9-]*)/gm,r=[],n=0,o;for(;(o=t.exec(e))!==null;)o.index>n&&r.push(e.substring(n,o.index)),r.push({content:o[1]}),n=t.lastIndex;return n<e.length&&r.push(e.substring(n)),r},bt=(e,...t)=>{let r=H(e,...t),n=btoa(`${te(r)}`).replace(/[+/=]/g,""),o=xe(r),s=new Map,a=i=>{let l=`${i}_${n.slice(0,6)}`,f=`.${l}`;return s.has(i)||s.set(i,l),f},c=o?.map(i=>typeof i=="string"?A(i):a(i.content)).join("")||"";return{classes:Object.fromEntries(s),styles:A(c).trim()}};var Et=(e,t,r=!0)=>{let n=e.startsWith("var(")?e.substring(4,e.length-5):e,o;if(typeof t=="number"&&r){let s=parseInt(getComputedStyle(document.documentElement).fontSize);o=`${t/s}rem`}return t&&document.documentElement.style.setProperty(n,o||t.toString()),getComputedStyle(document.documentElement).getPropertyValue(n)};var q="data-target",F="data-trigger";var ie=({id:e,connect:t,dev:r,strategy:n,context:o})=>{let{trigger:s,...a}=j({strategy:n,dev:r}),c;if(t){let i=o.tagName.toLowerCase(),l=o.id;e&&!l&&console.error(`island ${i} is missing an id attribute and cannot communicate with messenger`),c=t(e&&l?l:i,s),s({event:`connected->${e?l??`${i} with missing id`:i}`})}return{trigger:s,disconnect:c,...a}};var B=class{constructor(t){this.callback=t}handleEvent(t){this.callback(t)}},_=new WeakMap,D=Object.freeze({set:(e,t)=>{_.set(e,new B(t))},get:e=>_.get(e),has:e=>_.has(e)});var zt=({mode:e="open",delegatesFocus:t=!0,tag:r,...n},o)=>{var s,a,c,i,l,f,K,h,N,u,ae,T,U,d,ce,k;return k=class extends o{constructor(){super();S(this,f);S(this,h);S(this,u);S(this,T);S(this,d);S(this,s,!1);S(this,a,void 0);S(this,c,void 0);S(this,i,void 0);S(this,l,void 0);this.internals_=this.attachInternals();let m=this.internals_.shadowRoot;!m&&(m=this.attachShadow({mode:e,delegatesFocus:t})),!m.firstChild&&C(this,s,!0)}connectedCallback(){if(super.connectedCallback&&super.connectedCallback(),b(this,s)){let y=this.querySelector("template[shadowrootmode]");y?w(this,T,U).call(this,y):C(this,c,w(this,d,ce).call(this))}w(this,f,K).call(this),C(this,a,w(this,u,ae).call(this));let{disconnect:m,trigger:p,...v}=ie({context:this,...n});this.plait({$:this.$.bind(this),context:this,trigger:p,...v}),C(this,i,m),C(this,l,p)}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback(),b(this,c)&&b(this,c).disconnect(),b(this,a)&&b(this,a).disconnect(),b(this,i)&&(b(this,l).call(this,{event:`disconnected->${this.id||this.tagName.toLowerCase()}`}),b(this,i).call(this))}$(m){let p=this.internals_.shadowRoot,v=[];return p&&(v=[...p.querySelectorAll(`[${q}="${m}"]`)].filter(y=>y instanceof HTMLSlotElement?z(y):!0)),v}static define(){customElements.get(r)||customElements.define(r,this)}},s=new WeakMap,a=new WeakMap,c=new WeakMap,i=new WeakMap,l=new WeakMap,f=new WeakSet,K=function(){let m=this.internals_.shadowRoot;if(m){let p=[...m.querySelectorAll(`[${F}]`)].filter(v=>v instanceof HTMLSlotElement?z(v):!0);p.length&&w(this,h,N).call(this,p)}},h=new WeakSet,N=function(m){m.forEach(p=>{!D.has(p)&&D.set(p,y=>{let $=se(y,p);$?b(this,l).call(this,{event:$,detail:{event:y}}):p.removeEventListener(y.type,D.get(p))});let v=p.dataset.trigger;if(v){let y=ne(v);for(let $ of y)p.addEventListener($,D.get(p))}})},u=new WeakSet,ae=function(){let m=this.internals_.shadowRoot;if(m){let p=new MutationObserver(v=>{for(let y of v){if(y.addedNodes.length){let $=oe(y.addedNodes);$.length&&w(this,h,N).call(this,$)}y.type==="attributes"&&w(this,f,K).call(this)}});return p.observe(m,{attributeFilter:[F],childList:!0,subtree:!0}),p}},T=new WeakSet,U=function(m){let p=this.internals_.shadowRoot;p&&(!p.firstChild&&p.appendChild(document.importNode(m.content,!0)),m.remove())},d=new WeakSet,ce=function(){let m=new MutationObserver(()=>{let p=this.querySelector("template[shadowrootmode]");p&&(m.disconnect(),w(this,T,U).call(this,p))});return m.observe(this,{childList:!0}),m},k};var L=(e,...t)=>H(e,...t).trim().replace(/[\s\n]+>/g,">").replace(/(<.*?)(?:\s+)(\w)|>\s+</g,(o,s,a)=>s?[s,a].join(" "):"><").replace(/(>)(?:\s)(\S)|(\S)(?:\s)(<)/g,(o,s,a,c,i)=>s?[s,a].join(""):[c,i].join(""));var le=e=>{let t=[];for(let r in e){let n=e[r];if(n!=null){if(r==="target"){t.push(`${q}="${n}"`);continue}if(r==="triggers"){t.push(`${F}="${Object.entries(n).map(([o,s])=>`${o}->${s}`).join(" ")}"`);continue}if(r==="className"){t.push(`class="${n}"`);continue}if(r==="htmlFor"){t.push(`for="${n}"`);continue}if(!(!r.startsWith("aria")&&!n)){if(!r.startsWith("aria")&&typeof n=="boolean"){t.push(L`$${r}`);continue}t.push(L`${r}="$${n?.toString()}"`)}}}return t.join(" ")};var ve=(e,t)=>Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every(r=>Object.hasOwn(t,r)&&e[r]===t[r]),pe=e=>{let t=null;function r(n){if(t&&t.lastThis===this&&ve(n,t.lastProps))return t.lastResult;let o=e.call(this,n);return t={lastResult:o,lastProps:n,lastThis:this},o}return r.styles=new Set,r};var Yt=pe(({tag:e,template:t,mode:r="open",delegatesFocus:n=!0,slots:o,styles:s,...a})=>{let c=s&&L`<style>${typeof s=="string"?s:[...s]}</style>`;return L`
  <${e} ${le({...a})}>
    <template
      shadowrootmode="${r}"
      ${n&&"shadowrootdelegatesfocus"}
    >
      ${c}
      ${t}
    </template>
    ${o}
  </${e}>
  `});var er=(...e)=>{let t=e.filter(Boolean),r={};Object.assign(r,...t);for(let n in r)r[`--${n}`]=r[n],delete r[n];return r};var ge=(e,t)=>{let r=new Promise((n,o)=>{let s=indexedDB.open(e);s.onerror=()=>o(s.error),s.onsuccess=()=>n(s.result),s.onupgradeneeded=()=>{!s.result.objectStoreNames.contains(t)&&s.result.createObjectStore(t)}});return(n,o)=>r.then(s=>new Promise((a,c)=>{let i=s.transaction(t,n);i.oncomplete=()=>a(),i.onabort=i.onerror=()=>c(i.error),o(i.objectStore(t))}))};var nr=()=>{let e=new EventTarget;return Object.freeze({connect:(n,o)=>{let s=a=>o(a.detail);return e.addEventListener(n,s),()=>e.removeEventListener(n,s)},send:(n,o)=>{let s=new CustomEvent(n,{detail:o});e.dispatchEvent(s)}})};var cr=async(e,t,r)=>{let n=r||ge("USE_INDEXED_DB","STORE");await function(){return n("readwrite",l=>{l.put(t,e)})}();let o=i=>n("readwrite",l=>{let f=l.openCursor(e);f.onsuccess=function(){let h=this.result;if(h){let{value:g}=h;h.update(i(g));return}else console.error("cursor's value missing")}}),s=i=>n("readwrite",l=>l.put(i,e));return Object.freeze([()=>{let i;return n("readonly",l=>{i=l.get(e)}).then(()=>i.result)},i=>O(i)==="function"?o(i):s(i)])};var pr=({context:e,trigger:t})=>{let r=({data:s})=>{t(s)},n=(s,a)=>{e.postMessage({recipient:s,detail:a})};return e.addEventListener("message",r,!1),Object.freeze({send:n,disconnect:()=>e.removeEventListener("message",r)})};var mr=e=>{let t=e;return Object.freeze([()=>t,o=>{t=O(o)==="function"?o(t):o}])};var fr=({id:e,url:t,connect:r,send:n})=>{let o=new Worker(new URL(t,import.meta.url).href,{type:"module"}),a=r(e,i=>{o.postMessage(i)}),c=({data:i})=>{let{recipient:l,detail:f}=i;n(l,f)};return o.addEventListener("message",c,!1),()=>{a(),o.removeEventListener("message",c)}};var yr=({el:e,template:t,position:r="beforeend"})=>{let n=new DOMParser().parseFromString(t,"text/html",{includeShadowRoots:!0});e?.insertAdjacentElement(r,n.body.firstChild)};export{Yt as IslandTemplate,j as bProgram,He as classNames,ge as createIDB,bt as css,Et as cssVar,q as dataTarget,F as dataTrigger,L as html,yr as insertIsland,zt as isle,J as loop,nr as messenger,Q as sync,pe as template,X as thread,er as tokens,cr as useIndexedDB,pr as useMain,mr as useStore,fr as useWebWorker,le as wire};
