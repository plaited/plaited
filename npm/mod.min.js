var M={select:"select-event",snapshot:"state-snapshot"},A={randomized:"randomized",priority:"priority",chaos:"chaos",custom:"custom"};var z=({bids:e,selectedEvent:t})=>{let r=[];for(let n of e){let{generator:i,waitFor:s,block:c,request:a,thread:o,priority:l,trigger:d}=n,u={thread:o,priority:l},m;if(s&&Object.assign(u,{waitFor:Array.isArray(s)?s:[s]}),c&&Object.assign(u,{block:Array.isArray(c)?c:[c]}),a){let p=Array.isArray(a)?a:[a];p.some(({type:g})=>g===t.type&&l===t.priority)&&(m=t.type),Object.assign(u,{request:p})}r.push({...u,...d&&{trigger:d},...m&&{selected:m}})}return r.sort((n,i)=>n.priority-i.priority)};var B=()=>{let e=[];function t(r){for(let n in e)e[n](r)}return t.subscribe=r=>{e.push(n=>{n!==void 0&&r(n)})},t};var se=e=>{for(let t=e.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e.sort(({priority:t},{priority:r})=>t-r)[0]},oe=e=>e[Math.floor(Math.random()*Math.floor(e.length))],ie=e=>e.sort(({priority:t},{priority:r})=>t-r)[0],q={[A.priority]:ie,[A.chaos]:oe,[A.randomized]:se};var U=(...e)=>function*(){for(let t of e)yield*t()},V=(e,t=()=>!0)=>function*(){for(;t();)for(let r of e)yield*r()},_=e=>function*(){yield e};var G=({type:e,detail:t={}})=>({type:r,cb:n})=>n?n({detail:t,type:e}):e===r,K=({strategy:e=A.priority,dev:t}={})=>{let r=typeof e=="string"?q[e]:e,n=new Set,i=new Set,s=B();function c(){i.size&&a()}function a(){for(let p of i){let{generator:g,priority:x,thread:S,trigger:y}=p,{value:h,done:E}=g.next();!E&&n.add({thread:S,priority:x,...y&&{trigger:y},generator:g,...h}),i.delete(p)}o()}function o(){let p=[...n],g=[];for(let{request:h,priority:E}of p){if(Array.isArray(h)){g=g.concat(h.map(L=>({priority:E,...L})));continue}h&&g.push({priority:E,...h})}let x=p.flatMap(({block:h})=>h||[]),S=g.filter(h=>!x.some(G(h))),y=r(S);y&&(t&&s({kind:M.snapshot,data:z({bids:p,selectedEvent:y})}),l(y))}function l(p){for(let y of n){let{request:h=[],waitFor:E=[],generator:L}=y;[...Array.isArray(h)?h:[h],...Array.isArray(E)?E:[E]].some(G(p))&&L&&(i.add(y),n.delete(y))}let{priority:g,cb:x,...S}=p;s({kind:M.select,data:S}),c()}let d=({type:p,detail:g})=>{let x=function*(){yield{request:[{type:p,detail:g}],waitFor:[{type:"",cb:()=>!0}]}};i.add({thread:p,priority:0,trigger:!0,generator:x()}),c()},u=p=>{s.subscribe(({kind:g,data:x})=>{if(g===M.select){let{type:S,detail:y={}}=x;Object.hasOwn(p,S)&&p[S](y)}})},m=p=>{for(let g in p)i.add({thread:g,priority:i.size+1,generator:p[g]()})};return t&&s.subscribe(({kind:p,data:g})=>{p===M.snapshot&&t(g)}),Object.freeze({addThreads:m,feedback:u,trigger:d,loop:V,sync:_,thread:U})};var Pe=(...e)=>e.filter(Boolean).join(" ");var v=e=>Object.prototype.toString.call(e).slice(8,-1).toLowerCase();var ae=/[&<>'"]/g;var ce={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"};var{replace:le}="",de=e=>ce[e];var O=e=>le.call(e,ae,de);var W=e=>{let t=[...e].reduce((r,n)=>(r<<5)+r+n.charCodeAt(0),5381);return t===5381?null:t};var j="data-target",$="data-trigger",Z=new Set(["area","base","basefont","bgsound","br","col","command","embed","frame","hr","img","isindex","input","keygen","link","menuitem","meta","nextid","param","source","track","wbr","circle","ellipse","line","path","polygon","polyline","rect","stop","use"]),X=new Set(["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),C=new Set(["null","undefined","number","string","boolean","bigint"]);var pe=/^[a-z]+\-[a-z]+(?:\-[a-z]+)*$/,P=(e,t=[],r)=>`<${[e,...t].join(" ")}>${r.join("")}</${e}>`,Y=(e,t)=>{let{shadowrootmode:r="open",children:n,shadowrootdelegatesfocus:i=!0,trusted:s,slots:c,stylesheet:a,style:o,key:l,"data-trigger":d,...u}=t;if(typeof e=="function")return e(t);let m=new Set,p=n&&Array.isArray(n)?n:n?[n]:[];if(e==="script"&&!s)throw new Error("Script tag not allowed unless 'trusted' property set");let g=e.toLowerCase(),x=[];if(d){let f=Object.entries(d).map(([T,b])=>`${T}->${b}`).join(" ");x.push(`${$}="${f}"`)}if(o){let f=Object.entries(o).map(([T,b])=>`${T.replace(/[A-Z]/g,w=>`-${w.toLowerCase()}`)}:${b};`).join(" ");x.push(`style="${O(f)}"`)}for(let f in u){if(f.startsWith("on"))throw new Error(`Event handler attributes are not allowed:  [${f}]`);let T=u[f];if(!C.has(typeof T))throw new Error(`Attributes not declared in BaseAttrs must be of type Primitive: ${f} is not primitive`);if(X.has(f)){x.push(`${f}`);continue}let b=T??"";x.push(`${f}="${s?`${b}`:O(`${b}`)}"`)}if(typeof g=="string"&&Z.has(g))return{stylesheets:m,content:`<${[g,...x].join(" ")}/>`};let S=[],y=pe.test(g),h=[],E=[];if(y){h.push(`shadowrootmode="${r}"`),a&&E.push(P("style",void 0,[a])),h.push(`shadowrootdelegatesfocus="${i}"`);let f=c?Array.isArray(c)?c:[c]:[],T=f.length;for(let b=0;b<T;b++){let w=f[b];if(typeof w=="object"&&"content"in w){S.push(w.content);continue}if(!C.has(typeof w))continue;let N=w??"";S.push(s?`${N}`:O(`${N}`))}}let L=p.length;for(let f=0;f<L;f++){let T=p[f];if(y&&typeof T=="object"&&"content"in T){E.push(T.content);continue}if(typeof T=="object"&&"content"in T){S.push(T.content);continue}if(!C.has(typeof T))continue;let b=T??"";if(y){E.push(s?`${b}`:O(`${b}`));continue}S.push(s?`${b}`:O(`${b}`))}return y&&S.unshift(P("template",h,E)),{stylesheets:m,content:P(g,x,S)}};function ft({children:e}){return e=e&&Array.isArray(e)?e:e?[e]:[],{content:e.map(t=>typeof t=="string"?t:t.content).join("")}}var R=e=>e.replace(/(\s\s+|\n)/g," "),J=e=>v(e)==="string"||v(e)==="number",ge=(e,...t)=>{let{raw:r}=e,n=t.reduce((i,s,c)=>{i+=R(r[c]);let a=Array.isArray(s)?s.filter(J).join(""):J(s)?s:"";return i.endsWith("$")&&(a=escape(a),i=i.slice(0,-1)),i+a},"");return n+=R(r[r.length-1])},ue=e=>{let t=/\.(-?[_a-zA-Z]+[_a-zA-Z0-9-]*)/gm,r=[],n=0,i;for(;(i=t.exec(e))!==null;)i.index>n&&r.push(e.substring(n,i.index)),r.push({content:i[1]}),n=t.lastIndex;return n<e.length&&r.push(e.substring(n)),r},Tt=(e,...t)=>{let r=ge(e,...t),n=btoa(`${W(r)}`).replace(/[+/=]/g,""),i=ue(r),s=new Map,c=o=>{let l=`${o}_${n.slice(0,6)}`,d=`.${l}`;return s.has(o)||s.set(o,l),d},a=i?.map(o=>typeof o=="string"?R(o):c(o.content)).join("")||"";return{classes:Object.fromEntries(s),styles:R(a).trim()}};var Q=(e,t)=>{let r=new Promise((n,i)=>{let s=indexedDB.open(e);s.onerror=()=>i(s.error),s.onsuccess=()=>n(s.result),s.onupgradeneeded=()=>{!s.result.objectStoreNames.contains(t)&&s.result.createObjectStore(t)}});return(n,i)=>r.then(s=>new Promise((c,a)=>{let o=s.transaction(t,n);o.oncomplete=()=>c(),o.onabort=o.onerror=()=>a(o.error),i(o.objectStore(t))}))};var ee=({id:e,connect:t,dev:r,strategy:n,context:i})=>{let{trigger:s,...c}=K({strategy:n,dev:r}),a;if(t){let o=i.tagName.toLowerCase(),l=i.id;e&&!l&&console.error(`island ${o} is missing an id attribute and cannot communicate with messenger`),a=t(e&&l?l:o,s),s({type:`connected->${e?l??`${o} with missing id`:o}`})}return{trigger:s,disconnect:a,...c}};var D=class{constructor(t){this.callback=t}handleEvent(t){this.callback(t)}},I=new WeakMap,k=Object.freeze({set:(e,t)=>{I.set(e,new D(t))},get:e=>I.get(e),has:e=>I.has(e)});var F={attr(e,t){let r=this;return t===void 0?r.getAttribute(e):(t==null?r.removeAttribute(e):r.setAttribute(e,t),r)}},te={attr(e,t){let r=this;return typeof e=="string"?r.forEach(n=>n.attr(e,t)):r.forEach(n=>Object.entries(e).forEach(([i,s])=>n.attr(i,s))),r}};var me=e=>{let t=/(^\w+|(?:\s)\w+)(?:->)/g;return[...e.matchAll(t)].flatMap(([,r])=>r)},fe=(e,t)=>{let r=e.currentTarget===t||e.composedPath().find(c=>c?.tagName==="SLOT"&&c===t)?t:void 0;if(!r)return"";let n=`${e.type}->`,s=(r.dataset.trigger??"").trim().split(/\s+/).find(c=>c.includes(n));return s?s.replace(n,""):""},H=e=>!e.hasAttribute("slot")&&e.hasAttribute("name"),re=(e,t)=>{if(e.nodeType===1&&(e.hasAttribute("data-trigger")&&t.push(e),e.hasChildNodes())){let r=e.childNodes,n=r.length;for(let i=0;i<n;i++)re(r[i],t)}},It=({mode:e="open",delegatesFocus:t=!0,tag:r,...n},i=s=>class extends s{})=>{let s=()=>{if(customElements.get(r)){console.error(`${r} already defined`);return}customElements.define(r,i(class extends HTMLElement{constructor(){super();if(this.internals_=this.attachInternals(),this.internals_.shadowRoot?this.#e=this.internals_.shadowRoot:this.#e=this.attachShadow({mode:e,delegatesFocus:t}),this.trigger!==this.constructor.prototype.trigger)throw new Error("trigger cannot be overridden in a subclass.")}#t;#r;#n;#e;connectedCallback(){if(!this.internals_.shadowRoot?.firstChild){let a=this.querySelector("template[shadowrootmode]");a?this.#o(a):this.#r=this.#a()}if(this.plait){this.#s(this.#e.querySelectorAll(`[${$}]`));let{disconnect:a,trigger:o,...l}=ee({context:this,...n});this.plait({$:this.$.bind(this),context:this,trigger:o,...l}),this.#t=this.#i(),this.#n=a,this.trigger=o}}disconnectedCallback(){this.#r&&this.#r.disconnect(),this.#t&&this.#t.disconnect(),this.#n&&(this.trigger({type:`disconnected->${this.id||this.tagName.toLowerCase()}`}),this.#n())}#s(a){a.forEach(o=>{if(o.nodeType===1){if(o.tagName==="SLOT"&&!H(o))return;!k.has(o)&&k.set(o,d=>{let u=fe(d,o);u?this.trigger({type:u,detail:d}):o.removeEventListener(d.type,k.get(o))});let l=o.dataset.trigger;if(l){let d=me(l);for(let u of d)o.addEventListener(u,k.get(o))}}})}#i(){let a=new MutationObserver(o=>{for(let l of o)if(l.type==="attributes"){let d=l.target;d.nodeType===1&&this.#s([d])}else if(l.addedNodes.length){let d=[],u=l.addedNodes.length;for(let m=0;m<u;m++)re(l.addedNodes[m],d);this.#s(d)}});return a.observe(this.#e,{attributeFilter:[$],childList:!0,subtree:!0}),a}#o(a){!this.#e.firstChild&&this.#e.appendChild(document.importNode(a.content,!0)),a.remove()}#a(){let a=new MutationObserver(()=>{let o=this.querySelector("template[shadowrootmode]");o&&(a.disconnect(),this.#o(o))});return a.observe(this,{childList:!0}),a}$(a,o=!1){let l=`[${j}="${a}"]`;if(o){let u=[];return this.#e.querySelectorAll(l).forEach(m=>{(m.tagName!=="SLOT"||H(m))&&u.push(Object.assign(m,F))}),Object.assign(u,te)}let d=this.#e.querySelector(l);if(d&&(d.tagName!=="SLOT"||H(d)))return Object.assign(d,F)}}))};return s.template=c=>Y(r,c),s};var he=(e,t)=>Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every(r=>Object.hasOwn(t,r)&&e[r]===t[r]),Nt=e=>{let t=null;function r(n){if(t&&t.lastThis===this&&he(n,t.lastProps))return t.lastResult;let i=e.call(this,n);return t={lastResult:i,lastProps:n,lastThis:this},i}return r};var Bt=()=>{let e=new EventTarget;return Object.freeze({connect:(n,i)=>{let s=c=>i(c.detail);return e.addEventListener(n,s),()=>e.removeEventListener(n,s)},send:(n,i)=>{let s=new CustomEvent(n,{detail:i});e.dispatchEvent(s)}})};var Ut=(...e)=>"<!DOCTYPE html> "+e.map(t=>t.content).join("");var _t=e=>{let t=e.startsWith("var(")?e.substring(4,e.length-5):e;return Object.freeze([()=>getComputedStyle(document.documentElement).getPropertyValue(t),(i,s=!0)=>{let c;if(typeof i=="number"&&s){let a=parseInt(getComputedStyle(document.documentElement).fontSize);c=`${i/a}rem`}document.documentElement.style.setProperty(t,c||i.toString())}])};var Zt=async(e,t,r)=>{let n=r||Q("USE_INDEXED_DB","STORE");await function(){return n("readwrite",l=>{l.put(t,e)})}();let i=o=>n("readwrite",l=>{let d=l.openCursor(e);d.onsuccess=function(){let m=this.result;if(m){let{value:p}=m;m.update(o(p));return}else console.error("cursor's value missing")}}),s=o=>n("readwrite",l=>l.put(o,e));return Object.freeze([()=>{let o;return n("readonly",l=>{o=l.get(e)}).then(()=>o.result)},o=>v(o)==="function"?i(o):s(o)])};var Yt=({context:e,trigger:t})=>{let r=({data:s})=>{t(s)},n=(s,c)=>{e.postMessage({recipient:s,detail:c})};return e.addEventListener("message",r,!1),Object.freeze({send:n,disconnect:()=>e.removeEventListener("message",r)})};var ne=(e,t)=>{let r=Array.prototype.slice.call(e.childNodes),n=Array.prototype.slice.call(t.content.cloneNode(!0).childNodes),i=n.length,s=r.length,c=i,a=0,o=0,l=null;for(;a<s||o<c;)if(s===a){let d=c<i?o?n[o-1].nextSibling:n[c-o]:null;for(;o<c;)e.insertBefore(n[o++],d)}else if(c===o)for(;a<s;)(!l||!l.has(r[a]))&&r[a].remove(),a++;else if(r[a]===n[o])a++,o++;else if(r[s-1]===n[c-1])s--,c--;else if(r[a]===n[c-1]&&n[o]===r[s-1]){let d=r[--s].nextSibling(e).insertBefore(n[o++],r[a++].nextSibling);e.insertBefore(n[--c],d),r[s]=n[c]}else{if(!l){l=new Map;let d=o;for(;d<c;)l.set(n[d],d++)}if(l.has(r[a])){let d=l.get(r[a]);if(o<d&&d<c){let u=a,m=1;for(;++u<s&&u<c&&l.get(r[u])===d+m;)m++;if(m>d-o){let p=r[a];for(;o<d;)e.insertBefore(n[o++],p)}else e.replaceChild(n[o++],r[a++])}else a++}else r[a++].remove()}return n};var tr=(e,t)=>{let r,n=document.createElement("template");return Object.freeze([i=>{n.innerHTML=Array.isArray(i)?i.map(s=>t(s).content).join(""):t(i).content,e.replaceChildren(n.content.cloneNode(!0)),r=i},i=>{if(r)r=i(r),n.innerHTML=Array.isArray(r)?r.map(s=>t(s).content).join(""):t(r).content,ne(e,n);else throw new Error(`called update before render on [${e.getAttribute("data-target")}]`)}])};var sr=e=>{let t=e;return Object.freeze([()=>t,i=>{t=v(i)==="function"?i(structuredClone(t)):i}])};var ir=(...e)=>{let t={},r=(...i)=>{let s={},c=i.filter(Boolean);Object.assign(s,...c);for(let a in s)s[`--${a}`]=s[a],delete s[a];t=s};return r(...e),Object.freeze([()=>t,r])};var cr=({id:e,url:t,connect:r,send:n})=>{let i=new Worker(new URL(t,import.meta.url).href,{type:"module"}),c=r(e,o=>{i.postMessage(o)}),a=({data:o})=>{let{recipient:l,detail:d}=o;n(l,d)};return i.addEventListener("message",a,!1),()=>{c(),i.removeEventListener("message",a)}};export{ft as Fragment,K as bProgram,H as canUseSlot,Pe as classNames,Q as createIDB,Y as createTemplate,Tt as css,fe as getTriggerKey,Y as h,It as isle,V as loop,me as matchAllEvents,Nt as memo,Bt as messenger,R as reduceWhitespace,Ut as ssr,_ as sync,U as thread,_t as useCSSVar,Zt as useIndexedDB,Yt as useMain,tr as useRender,sr as useStore,ir as useTokens,cr as useWebWorker};
