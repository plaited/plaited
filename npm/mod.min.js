var R={select:"select-event",snapshot:"state-snapshot"},O={randomized:"randomized",priority:"priority",chaos:"chaos",custom:"custom"};var B=({bids:e,selectedEvent:t})=>{let r=[];for(let n of e){let{generator:s,waitFor:o,block:c,request:a,thread:i,priority:d,trigger:u}=n,y={thread:i,priority:d},g;if(o&&Object.assign(y,{waitFor:Array.isArray(o)?o:[o]}),c&&Object.assign(y,{block:Array.isArray(c)?c:[c]}),a){let f=Array.isArray(a)?a:[a];f.some(({type:p})=>p===t.type&&d===t.priority)&&(g=t.type),Object.assign(y,{request:f})}r.push({...y,...u&&{trigger:u},...g&&{selected:g}})}return r.sort((n,s)=>n.priority-s.priority)};var V=()=>{let e=[];function t(r){for(let n in e)e[n](r)}return t.subscribe=r=>{e.push(n=>{n!==void 0&&r(n)})},t};var oe=e=>{for(let t=e.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e.sort(({priority:t},{priority:r})=>t-r)[0]},ie=e=>e[Math.floor(Math.random()*Math.floor(e.length))],ae=e=>e.sort(({priority:t},{priority:r})=>t-r)[0],_={[O.priority]:ae,[O.chaos]:ie,[O.randomized]:oe};var G=(...e)=>function*(){for(let t of e)yield*t()},j=(e,t=()=>!0)=>function*(){for(;t();)for(let r of e)yield*r()},W=e=>function*(){yield e};var K=({type:e,detail:t={}})=>({type:r,cb:n})=>n?n({detail:t,type:e}):e===r,U=({strategy:e=O.priority,dev:t}={})=>{let r=typeof e=="string"?_[e]:e,n=new Set,s=new Set,o=V();function c(){s.size&&a()}function a(){for(let f of s){let{generator:p,priority:x,thread:T,trigger:E}=f,{value:l,done:m}=p.next();!m&&n.add({thread:T,priority:x,...E&&{trigger:E},generator:p,...l}),s.delete(f)}i()}function i(){let f=[...n],p=[];for(let{request:l,priority:m}of f){if(Array.isArray(l)){p=p.concat(l.map(b=>({priority:m,...b})));continue}l&&p.push({priority:m,...l})}let x=f.flatMap(({block:l})=>l||[]),T=p.filter(l=>!x.some(K(l))),E=r(T);E&&(t&&o({kind:R.snapshot,data:B({bids:f,selectedEvent:E})}),d(E))}function d(f){for(let E of n){let{request:l=[],waitFor:m=[],generator:b}=E;[...Array.isArray(l)?l:[l],...Array.isArray(m)?m:[m]].some(K(f))&&b&&(s.add(E),n.delete(E))}let{priority:p,cb:x,...T}=f;o({kind:R.select,data:T}),c()}let u=({type:f,detail:p})=>{let x=function*(){yield{request:[{type:f,detail:p}],waitFor:[{type:"",cb:()=>!0}]}};s.add({thread:f,priority:0,trigger:!0,generator:x()}),c()},y=f=>{o.subscribe(({kind:p,data:x})=>{if(p===R.select){let{type:T,detail:E={}}=x;Object.hasOwn(f,T)&&f[T](E)}})},g=f=>{for(let p in f)s.add({thread:p,priority:s.size+1,generator:f[p]()})};return t&&o.subscribe(({kind:f,data:p})=>{f===R.snapshot&&t(p)}),Object.freeze({addThreads:g,feedback:y,trigger:u,loop:j,sync:W,thread:G})};var De=(...e)=>e.filter(Boolean).join(" ");var $=e=>Object.prototype.toString.call(e).slice(8,-1).toLowerCase();var Z=()=>!!(typeof window<"u"&&window.document&&window.document.createElement);var ce=/[&<>'"]/g;var le={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"};var{replace:de}="",pe=e=>le[e];var A=e=>de.call(e,ce,pe);var X=e=>{let t=[...e].reduce((r,n)=>(r<<5)+r+n.charCodeAt(0),5381);return t===5381?null:t};var Y="data-target",P="data-trigger",I=new Set(["area","base","basefont","bgsound","br","col","command","embed","frame","hr","img","isindex","input","keygen","link","menuitem","meta","nextid","param","source","track","wbr","circle","ellipse","line","path","polygon","polyline","rect","stop","use"]),D=new Set(["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),C=new Set(["null","undefined","number","string","boolean","bigint"]);var J=/^[a-z]+\-[a-z]+(?:\-[a-z]+)*$/,F=(e,t=[],r)=>`<${[e,...t].join(" ")}>${r.join("")}</${e}>`,ge=(e,t)=>{let{shadowrootmode:r="open",children:n,shadowrootdelegatesfocus:s=!0,trusted:o,slots:c,stylesheet:a,style:i,key:d,"data-trigger":u,...y}=t;if(typeof e=="function")return e(t);let g=new Set;a&&g.add(a);let f=n&&Array.isArray(n)?n:n?[n]:[];if(e==="script"&&!o)throw new Error("Script tag not allowed unless 'trusted' property set");let p=e.toLowerCase(),x=[];if(u){let h=Object.entries(u).map(([S,v])=>`${S}->${v}`).join(" ");x.push(`${P}="${h}"`)}if(i){let h=Object.entries(i).map(([S,v])=>`${S.replace(/[A-Z]/g,w=>`-${w.toLowerCase()}`)}:${v};`).join(" ");x.push(`style="${A(h)}"`)}for(let h in y){if(h.startsWith("on"))throw new Error(`Event handler attributes are not allowed:  [${h}]`);let S=y[h];if(!C.has(typeof S))throw new Error(`Attributes not declared in BaseAttrs must be of type Primitive: ${h} is not primitive`);if(D.has(h)){x.push(`${h}`);continue}let v=S??"";x.push(`${h}="${o?`${v}`:A(`${v}`)}"`)}if(I.has(p))return{stylesheets:g,content:`<${[p,...x].join(" ")}/>`};let T=[],E=J.test(p),l=[],m=[];if(E){l.push(`shadowrootmode="${r}"`),g.size&&m.push(F("style",void 0,[...g])),l.push(`shadowrootdelegatesfocus="${s}"`);let h=c?Array.isArray(c)?c:[c]:[],S=h.length;for(let v=0;v<S;v++){let w=h[v];if(typeof w=="object"&&"content"in w){T.push(w.content);continue}if(!C.has(typeof w))continue;let q=w??"";T.push(o?`${q}`:A(`${q}`))}}let b=f.length;for(let h=0;h<b;h++){let S=f[h];if(E&&typeof S=="object"&&"content"in S){m.push(S.content);for(let w of S.stylesheets)g.add(w);continue}if(typeof S=="object"&&"content"in S){T.push(S.content);for(let w of S.stylesheets)g.add(w);continue}if(!C.has(typeof S))continue;let v=S??"";if(E){m.push(o?`${v}`:A(`${v}`));continue}T.push(o?`${v}`:A(`${v}`))}return E&&(g.clear(),T.unshift(F("template",l,m))),{stylesheets:g,content:F(p,x,T)}},ue=(e,t)=>{let{shadowrootmode:r="open",children:n,shadowrootdelegatesfocus:s=!0,trusted:o,slots:c,stylesheet:a,style:i,key:d,"data-trigger":u,...y}=t;if(typeof e=="function")return e(t);let g=new Set;a&&g.add(a);let f=n&&Array.isArray(n)?n:n?[n]:[];if(e==="script"&&!o)throw new Error("Script tag not allowed unless 'trusted' property set");let p=document.createElement(e);if(u){let l=Object.entries(u).map(([m,b])=>`${m}->${b}`).join(" ");p.setAttribute(P,l)}if(i){let l=Object.entries(i).map(([m,b])=>`${m.replace(/[A-Z]/g,h=>`-${h.toLowerCase()}`)}:${b};`).join(" ");p.setAttribute("style",A(l))}for(let l in y){if(l.startsWith("on"))throw new Error(`Event handler attributes are not allowed:  [${l}]`);let m=y[l];if(!C.has(typeof m))throw new Error(`Attributes not declared in BaseAttrs must be of type Primitive: ${l} is not primitive`);if(D.has(l)){p.setAttribute(l,"");continue}let b=m??"";p.setAttribute(l,o?`${b}`:A(`${b}`))}if(I.has(e))return{stylesheets:g,content:p};let x=J.test(e),T=document.createElement("template");if(x){p.appendChild(T),T.setAttribute("shadowrootmode",r),T.setAttribute("shadowrootdelegatesfocus",`${s}`);let l=c?Array.isArray(c)?c:[c]:[],m=l.length;for(let b=0;b<m;b++){let h=l[b];if(typeof h=="object"&&"content"in h){p.appendChild(h.content);continue}if(!C.has(typeof h))continue;let S=h??"";p.append(o?`${S}`:A(`${S}`))}}let E=f.length;for(let l=0;l<E;l++){let m=f[l];if(x&&typeof m=="object"&&"content"in m){T.appendChild(m.content);for(let h of m.stylesheets)g.add(h);continue}if(typeof m=="object"&&"content"in m){p.appendChild(m.content);for(let h of m.stylesheets)g.add(h);continue}if(!C.has(typeof m))continue;let b=m??"";if(x){T.append(o?`${b}`:A(`${b}`));continue}p.append(o?`${b}`:A(`${b}`))}if(x){if(g.size){let l=document.createElement("style");l.innerHTML=[...g].join(""),T.appendChild(l)}g.clear()}return{stylesheets:g,content:p}};function Q(e,t){return Z()?ue(e,t):ge(e,t)}function yt({children:e}){return e=e&&Array.isArray(e)?e:e?[e]:[],{content:e.map(t=>typeof t=="string"?t:t.content).join("")}}var k=e=>e.replace(/(\s\s+|\n)/g," "),ee=e=>$(e)==="string"||$(e)==="number",me=(e,...t)=>{let{raw:r}=e,n=t.reduce((s,o,c)=>{s+=k(r[c]);let a=Array.isArray(o)?o.filter(ee).join(""):ee(o)?o:"";return s.endsWith("$")&&(a=escape(a),s=s.slice(0,-1)),s+a},"");return n+=k(r[r.length-1])},fe=e=>{let t=/\.(-?[_a-zA-Z]+[_a-zA-Z0-9-]*)/gm,r=[],n=0,s;for(;(s=t.exec(e))!==null;)s.index>n&&r.push(e.substring(n,s.index)),r.push({content:s[1]}),n=t.lastIndex;return n<e.length&&r.push(e.substring(n)),r},bt=(e,...t)=>{let r=me(e,...t),n=btoa(`${X(r)}`).replace(/[+/=]/g,""),s=fe(r),o=new Map,c=i=>{let d=`${i}_${n.slice(0,6)}`,u=`.${d}`;return o.has(i)||o.set(i,d),u},a=s?.map(i=>typeof i=="string"?k(i):c(i.content)).join("")||"";return{classes:Object.fromEntries(o),styles:k(a).trim()}};var te=(e,t)=>{let r=new Promise((n,s)=>{let o=indexedDB.open(e);o.onerror=()=>s(o.error),o.onsuccess=()=>n(o.result),o.onupgradeneeded=()=>{!o.result.objectStoreNames.contains(t)&&o.result.createObjectStore(t)}});return(n,s)=>r.then(o=>new Promise((c,a)=>{let i=o.transaction(t,n);i.oncomplete=()=>c(),i.onabort=i.onerror=()=>a(i.error),s(i.objectStore(t))}))};var re=({id:e,connect:t,dev:r,strategy:n,context:s})=>{let{trigger:o,...c}=U({strategy:n,dev:r}),a;if(t){let i=s.tagName.toLowerCase(),d=s.id;e&&!d&&console.error(`island ${i} is missing an id attribute and cannot communicate with messenger`),a=t(e&&d?d:i,o),o({type:`connected->${e?d??`${i} with missing id`:i}`})}return{trigger:o,disconnect:a,...c}};var z=class{constructor(t){this.callback=t}handleEvent(t){this.callback(t)}},H=new WeakMap,L=Object.freeze({set:(e,t)=>{H.set(e,new z(t))},get:e=>H.get(e),has:e=>H.has(e)});var M={render(e,t,r){let n=this,s=document.createElement("template");return Array.isArray(e)?s.content.append(...e.map(o=>t(o).content)):s.content.append(t(e).content),r?(n.insertAdjacentElement(r,s),s.replaceWith(s.content),n):(n.replaceChildren(s.content),n)},replace(e,t){let r=this,n=document.createElement("template");Array.isArray(e)?n.content.append(...e.map(s=>t(s).content)):n.content.append(t(e).content),r.replaceWith(n.content)},attr(e,t){let r=this;return t===void 0?r.getAttribute(e):(t==null?r.removeAttribute(e):r.setAttribute(e,t),r)}},ne={render(e,t,r){let n=this;return n.forEach((s,o)=>s.render(e[o],t,r)),n},replace(e,t){let r=this;return r.forEach((n,s)=>n.replace(e[s],t)),r},attr(e,t){let r=this;return typeof e=="string"?r.forEach(n=>n.attr(e,t)):r.forEach(n=>Object.entries(e).forEach(([s,o])=>n.attr(s,o))),r}},Pt=e=>(Object.assign(e,M),e);var he=e=>{let t=/(^\w+|(?:\s)\w+)(?:->)/g;return[...e.matchAll(t)].flatMap(([,r])=>r)},ye=(e,t)=>{let r=e.currentTarget===t||e.composedPath().find(c=>c?.tagName==="SLOT"&&c===t)?t:void 0;if(!r)return"";let n=`${e.type}->`,o=(r.dataset.trigger??"").trim().split(/\s+/).find(c=>c.includes(n));return o?o.replace(n,""):""},N=e=>!e.hasAttribute("slot")&&e.hasAttribute("name"),se=(e,t)=>{if(e.nodeType===1&&(e.hasAttribute("data-trigger")&&t.push(e),e.hasChildNodes())){let r=e.childNodes,n=r.length;for(let s=0;s<n;s++)se(r[s],t)}},Ht=({mode:e="open",delegatesFocus:t=!0,tag:r,...n},s=o=>class extends o{})=>{let o=()=>{if(customElements.get(r)){console.error(`${r} already defined`);return}customElements.define(r,s(class extends HTMLElement{constructor(){super();if(this.internals_=this.attachInternals(),this.internals_.shadowRoot?this.#e=this.internals_.shadowRoot:this.#e=this.attachShadow({mode:e,delegatesFocus:t}),this.trigger!==this.constructor.prototype.trigger)throw new Error("trigger cannot be overridden in a subclass.")}#t;#r;#n;#e;connectedCallback(){if(!this.internals_.shadowRoot?.firstChild){let a=this.querySelector("template[shadowrootmode]");a?this.#o(a):this.#r=this.#a()}if(this.plait){this.#s(this.#e.querySelectorAll(`[${P}]`));let{disconnect:a,trigger:i,...d}=re({context:this,...n});this.plait({$:this.$.bind(this),context:this,trigger:i,...d}),this.#t=this.#i(),this.#n=a,this.trigger=i}}disconnectedCallback(){this.#r&&this.#r.disconnect(),this.#t&&this.#t.disconnect(),this.#n&&(this.trigger({type:`disconnected->${this.id||this.tagName.toLowerCase()}`}),this.#n())}#s(a){a.forEach(i=>{if(i.nodeType===1){if(i.tagName==="SLOT"&&!N(i))return;!L.has(i)&&L.set(i,u=>{let y=ye(u,i);y?this.trigger({type:y,detail:u}):i.removeEventListener(u.type,L.get(i))});let d=i.dataset.trigger;if(d){let u=he(d);for(let y of u)i.addEventListener(y,L.get(i))}}})}#i(){let a=new MutationObserver(i=>{for(let d of i)if(d.type==="attributes"){let u=d.target;u.nodeType===1&&this.#s([u])}else if(d.addedNodes.length){let u=[],y=d.addedNodes.length;for(let g=0;g<y;g++)se(d.addedNodes[g],u);this.#s(u)}});return a.observe(this.#e,{attributeFilter:[P],childList:!0,subtree:!0}),a}#o(a){!this.#e.firstChild&&this.#e.appendChild(document.importNode(a.content,!0)),a.remove()}#a(){let a=new MutationObserver(()=>{let i=this.querySelector("template[shadowrootmode]");i&&(a.disconnect(),this.#o(i))});return a.observe(this,{childList:!0}),a}$(a,i=!1){let d=`[${Y}="${a}"]`;if(i){let y=[];return this.#e.querySelectorAll(d).forEach(g=>{(g.tagName!=="SLOT"||N(g))&&y.push(Object.assign(g,M))}),Object.assign(y,ne)}let u=this.#e.querySelector(d);return u?u.tagName!=="SLOT"||N(u)?Object.assign(u,M):{}:{}}}))};return o.template=c=>Q(r,c),o};var Te=(e,t)=>Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every(r=>Object.hasOwn(t,r)&&e[r]===t[r]),Bt=e=>{let t=null;function r(n){if(t&&t.lastThis===this&&Te(n,t.lastProps))return t.lastResult;let s=e.call(this,n);return t={lastResult:s,lastProps:n,lastThis:this},s}return r};var _t=()=>{let e=new EventTarget;return Object.freeze({connect:(n,s)=>{let o=c=>s(c.detail);return e.addEventListener(n,o),()=>e.removeEventListener(n,o)},send:(n,s)=>{let o=new CustomEvent(n,{detail:s});e.dispatchEvent(o)}})};var jt=(...e)=>"<!DOCTYPE html> "+e.map(t=>t.content).join("");var Kt=e=>{let t=e.startsWith("var(")?e.substring(4,e.length-5):e;return Object.freeze([()=>getComputedStyle(document.documentElement).getPropertyValue(t),(s,o=!0)=>{let c;if(typeof s=="number"&&o){let a=parseInt(getComputedStyle(document.documentElement).fontSize);c=`${s/a}rem`}document.documentElement.style.setProperty(t,c||s.toString())}])};var Jt=async(e,t,r)=>{let n=r||te("USE_INDEXED_DB","STORE");await function(){return n("readwrite",d=>{d.put(t,e)})}();let s=i=>n("readwrite",d=>{let u=d.openCursor(e);u.onsuccess=function(){let g=this.result;if(g){let{value:f}=g;g.update(i(f));return}else console.error("cursor's value missing")}}),o=i=>n("readwrite",d=>d.put(i,e));return Object.freeze([()=>{let i;return n("readonly",d=>{i=d.get(e)}).then(()=>i.result)},i=>$(i)==="function"?s(i):o(i)])};var er=({context:e,trigger:t})=>{let r=({data:o})=>{t(o)},n=(o,c)=>{e.postMessage({recipient:o,detail:c})};return e.addEventListener("message",r,!1),Object.freeze({send:n,disconnect:()=>e.removeEventListener("message",r)})};var nr=e=>{let t=e;return Object.freeze([()=>t,s=>{t=$(s)==="function"?s(structuredClone(t)):s}])};var or=(...e)=>{let t={},r=(...s)=>{let o={},c=s.filter(Boolean);Object.assign(o,...c);for(let a in o)o[`--${a}`]=o[a],delete o[a];t=o};return r(...e),Object.freeze([()=>t,r])};var ar=({id:e,url:t,connect:r,send:n})=>{let s=new Worker(new URL(t,import.meta.url).href,{type:"module"}),c=r(e,i=>{s.postMessage(i)}),a=({data:i})=>{let{recipient:d,detail:u}=i;n(d,u)};return s.addEventListener("message",a,!1),()=>{c(),s.removeEventListener("message",a)}};export{yt as Fragment,U as bProgram,N as canUseSlot,De as classNames,ue as createClient,te as createIDB,ge as createServer,Q as createTemplate,bt as css,ye as getTriggerKey,Q as h,Ht as isle,j as loop,he as matchAllEvents,Bt as memo,_t as messenger,k as reduceWhitespace,jt as ssr,M as sugar,ne as sugarForEach,W as sync,G as thread,Kt as useCSSVar,Jt as useIndexedDB,er as useMain,nr as useStore,Pt as useSugar,or as useTokens,ar as useWebWorker};
