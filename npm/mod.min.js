var M={select:"select-event",snapshot:"state-snapshot"},O={randomized:"randomized",priority:"priority",chaos:"chaos",custom:"custom"};var z=({bids:e,selectedEvent:t})=>{let r=[];for(let n of e){let{generator:s,waitFor:o,block:c,request:a,thread:i,priority:l,trigger:g}=n,d={thread:i,priority:l},m;if(o&&Object.assign(d,{waitFor:Array.isArray(o)?o:[o]}),c&&Object.assign(d,{block:Array.isArray(c)?c:[c]}),a){let p=Array.isArray(a)?a:[a];p.some(({type:u})=>u===t.type&&l===t.priority)&&(m=t.type),Object.assign(d,{request:p})}r.push({...d,...g&&{trigger:g},...m&&{selected:m}})}return r.sort((n,s)=>n.priority-s.priority)};var q=()=>{let e=[];function t(r){for(let n in e)e[n](r)}return t.subscribe=r=>{e.push(n=>{n!==void 0&&r(n)})},t};var ne=e=>{for(let t=e.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e.sort(({priority:t},{priority:r})=>t-r)[0]},se=e=>e[Math.floor(Math.random()*Math.floor(e.length))],oe=e=>e.sort(({priority:t},{priority:r})=>t-r)[0],B={[O.priority]:oe,[O.chaos]:se,[O.randomized]:ne};var V=(...e)=>function*(){for(let t of e)yield*t()},_=(e,t=()=>!0)=>function*(){for(;t();)for(let r of e)yield*r()},G=e=>function*(){yield e};var W=({type:e,detail:t={}})=>({type:r,cb:n})=>n?n({detail:t,type:e}):e===r,K=({strategy:e=O.priority,dev:t}={})=>{let r=typeof e=="string"?B[e]:e,n=new Set,s=new Set,o=q();function c(){s.size&&a()}function a(){for(let p of s){let{generator:u,priority:x,thread:S,trigger:y}=p,{value:h,done:b}=u.next();!b&&n.add({thread:S,priority:x,...y&&{trigger:y},generator:u,...h}),s.delete(p)}i()}function i(){let p=[...n],u=[];for(let{request:h,priority:b}of p){if(Array.isArray(h)){u=u.concat(h.map(L=>({priority:b,...L})));continue}h&&u.push({priority:b,...h})}let x=p.flatMap(({block:h})=>h||[]),S=u.filter(h=>!x.some(W(h))),y=r(S);y&&(t&&o({kind:M.snapshot,data:z({bids:p,selectedEvent:y})}),l(y))}function l(p){for(let y of n){let{request:h=[],waitFor:b=[],generator:L}=y;[...Array.isArray(h)?h:[h],...Array.isArray(b)?b:[b]].some(W(p))&&L&&(s.add(y),n.delete(y))}let{priority:u,cb:x,...S}=p;o({kind:M.select,data:S}),c()}let g=({type:p,detail:u})=>{let x=function*(){yield{request:[{type:p,detail:u}],waitFor:[{type:"",cb:()=>!0}]}};s.add({thread:p,priority:0,trigger:!0,generator:x()}),c()},d=p=>{o.subscribe(({kind:u,data:x})=>{if(u===M.select){let{type:S,detail:y={}}=x;Object.hasOwn(p,S)&&p[S](y)}})},m=p=>{for(let u in p)s.add({thread:u,priority:s.size+1,generator:p[u]()})};return t&&o.subscribe(({kind:p,data:u})=>{p===M.snapshot&&t(u)}),Object.freeze({addThreads:m,feedback:d,trigger:g,loop:_,sync:G,thread:V})};var Ce=(...e)=>e.filter(Boolean).join(" ");var v=e=>Object.prototype.toString.call(e).slice(8,-1).toLowerCase();var ie=/[&<>'"]/g;var ae={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"};var{replace:ce}="",le=e=>ae[e];var A=e=>ce.call(e,ie,le);var U=e=>{let t=[...e].reduce((r,n)=>(r<<5)+r+n.charCodeAt(0),5381);return t===5381?null:t};var j="data-target",$="data-trigger",Z=new Set(["area","base","basefont","bgsound","br","col","command","embed","frame","hr","img","isindex","input","keygen","link","menuitem","meta","nextid","param","source","track","wbr","circle","ellipse","line","path","polygon","polyline","rect","stop","use"]),X=new Set(["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),P=new Set(["null","undefined","number","string","boolean","bigint"]);var ge=/^[a-z]+\-[a-z]+(?:\-[a-z]+)*$/,I=(e,t=[],r)=>`<${[e,...t].join(" ")}>${r.join("")}</${e}>`,Y=(e,t)=>{let{shadowrootmode:r="open",children:n,shadowrootdelegatesfocus:s=!0,trusted:o,slots:c,stylesheet:a,style:i,key:l,"data-trigger":g,...d}=t;if(typeof e=="function")return e(t);let m=new Set,p=n&&Array.isArray(n)?n:n?[n]:[];if(e==="script"&&!o)throw new Error("Script tag not allowed unless 'trusted' property set");let u=e.toLowerCase(),x=[];if(g){let f=Object.entries(g).map(([T,E])=>`${T}->${E}`).join(" ");x.push(`${$}="${f}"`)}if(i){let f=Object.entries(i).map(([T,E])=>`${T.replace(/[A-Z]/g,w=>`-${w.toLowerCase()}`)}:${E};`).join(" ");x.push(`style="${A(f)}"`)}for(let f in d){if(f.startsWith("on"))throw new Error(`Event handler attributes are not allowed:  [${f}]`);let T=d[f];if(!P.has(typeof T))throw new Error(`Attributes not declared in BaseAttrs must be of type Primitive: ${f} is not primitive`);if(X.has(f)){x.push(`${f}`);continue}let E=T??"";x.push(`${f}="${o?`${E}`:A(`${E}`)}"`)}if(typeof u=="string"&&Z.has(u))return{stylesheets:m,content:`<${[u,...x].join(" ")}/>`};let S=[],y=ge.test(u),h=[],b=[];if(y){h.push(`shadowrootmode="${r}"`),a&&b.push(I("style",void 0,[a])),h.push(`shadowrootdelegatesfocus="${s}"`);let f=c?Array.isArray(c)?c:[c]:[],T=f.length;for(let E=0;E<T;E++){let w=f[E];if(typeof w=="object"&&"content"in w){S.push(w.content);continue}if(!P.has(typeof w))continue;let N=w??"";S.push(o?`${N}`:A(`${N}`))}}let L=p.length;for(let f=0;f<L;f++){let T=p[f];if(y&&typeof T=="object"&&"content"in T){b.push(T.content);continue}if(typeof T=="object"&&"content"in T){S.push(T.content);continue}if(!P.has(typeof T))continue;let E=T??"";if(y){b.push(o?`${E}`:A(`${E}`));continue}S.push(o?`${E}`:A(`${E}`))}return y&&S.unshift(I("template",h,b)),{stylesheets:m,content:I(u,x,S)}};function mt({children:e}){return e=e&&Array.isArray(e)?e:e?[e]:[],{content:e.map(t=>typeof t=="string"?t:t.content).join("")}}var C=e=>e.replace(/(\s\s+|\n)/g," "),J=e=>v(e)==="string"||v(e)==="number",pe=(e,...t)=>{let{raw:r}=e,n=t.reduce((s,o,c)=>{s+=C(r[c]);let a=Array.isArray(o)?o.filter(J).join(""):J(o)?o:"";return s.endsWith("$")&&(a=escape(a),s=s.slice(0,-1)),s+a},"");return n+=C(r[r.length-1])},ue=e=>{let t=/\.(-?[_a-zA-Z]+[_a-zA-Z0-9-]*)/gm,r=[],n=0,s;for(;(s=t.exec(e))!==null;)s.index>n&&r.push(e.substring(n,s.index)),r.push({content:s[1]}),n=t.lastIndex;return n<e.length&&r.push(e.substring(n)),r},yt=(e,...t)=>{let r=pe(e,...t),n=btoa(`${U(r)}`).replace(/[+/=]/g,""),s=ue(r),o=new Map,c=i=>{let l=`${i}_${n.slice(0,6)}`,g=`.${l}`;return o.has(i)||o.set(i,l),g},a=s?.map(i=>typeof i=="string"?C(i):c(i.content)).join("")||"";return{classes:Object.fromEntries(o),styles:C(a).trim()}};var Q=(e,t)=>{let r=new Promise((n,s)=>{let o=indexedDB.open(e);o.onerror=()=>s(o.error),o.onsuccess=()=>n(o.result),o.onupgradeneeded=()=>{!o.result.objectStoreNames.contains(t)&&o.result.createObjectStore(t)}});return(n,s)=>r.then(o=>new Promise((c,a)=>{let i=o.transaction(t,n);i.oncomplete=()=>c(),i.onabort=i.onerror=()=>a(i.error),s(i.objectStore(t))}))};var ee=({id:e,connect:t,dev:r,strategy:n,context:s})=>{let{trigger:o,...c}=K({strategy:n,dev:r}),a;if(t){let i=s.tagName.toLowerCase(),l=s.id;e&&!l&&console.error(`island ${i} is missing an id attribute and cannot communicate with messenger`),a=t(e&&l?l:i,o),o({type:`connected->${e?l??`${i} with missing id`:i}`})}return{trigger:o,disconnect:a,...c}};var F=class{constructor(t){this.callback=t}handleEvent(t){this.callback(t)}},D=new WeakMap,k=Object.freeze({set:(e,t)=>{D.set(e,new F(t))},get:e=>D.get(e),has:e=>D.has(e)});var R={render(e,t,r){let n=this,s=document.createElement("template");return s.innerHTML=Array.isArray(e)?e.map(o=>t(o).content).join(""):t(e).content,r?(n.insertAdjacentElement(r,s),s.replaceWith(s.content.cloneNode(!0)),n):(n.replaceChildren(s.content.cloneNode(!0)),n)},replace(e,t){let r=this,n=document.createElement("template");n.innerHTML=Array.isArray(e)?e.map(s=>t(s).content).join(""):t(e).content,r.replaceWith(n.content.cloneNode(!0))},attr(e,t){let r=this;return t===void 0?r.getAttribute(e):(t==null?r.removeAttribute(e):r.setAttribute(e,t),r)}},te={render(e,t,r){let n=this;return n.forEach((s,o)=>s.render(e[o],t,r)),n},replace(e,t){let r=this;return r.forEach((n,s)=>n.replace(e[s],t)),r},attr(e,t){let r=this;return typeof e=="string"?r.forEach(n=>n.attr(e,t)):r.forEach(n=>Object.entries(e).forEach(([s,o])=>n.attr(s,o))),r}},At=e=>{Object.assign(e,R)};var de=e=>{let t=/(^\w+|(?:\s)\w+)(?:->)/g;return[...e.matchAll(t)].flatMap(([,r])=>r)},me=(e,t)=>{let r=e.currentTarget===t||e.composedPath().find(c=>c?.tagName==="SLOT"&&c===t)?t:void 0;if(!r)return"";let n=`${e.type}->`,o=(r.dataset.trigger??"").trim().split(/\s+/).find(c=>c.includes(n));return o?o.replace(n,""):""},H=e=>!e.hasAttribute("slot")&&e.hasAttribute("name"),re=(e,t)=>{if(e.nodeType===1&&(e.hasAttribute("data-trigger")&&t.push(e),e.hasChildNodes())){let r=e.childNodes,n=r.length;for(let s=0;s<n;s++)re(r[s],t)}},It=({mode:e="open",delegatesFocus:t=!0,tag:r,...n},s=o=>class extends o{})=>{let o=()=>{if(customElements.get(r)){console.error(`${r} already defined`);return}customElements.define(r,s(class extends HTMLElement{constructor(){super();if(this.internals_=this.attachInternals(),this.internals_.shadowRoot?this.#e=this.internals_.shadowRoot:this.#e=this.attachShadow({mode:e,delegatesFocus:t}),this.trigger!==this.constructor.prototype.trigger)throw new Error("trigger cannot be overridden in a subclass.")}#t;#r;#n;#e;connectedCallback(){if(!this.internals_.shadowRoot?.firstChild){let a=this.querySelector("template[shadowrootmode]");a?this.#o(a):this.#r=this.#a()}if(this.plait){this.#s(this.#e.querySelectorAll(`[${$}]`));let{disconnect:a,trigger:i,...l}=ee({context:this,...n});this.plait({$:this.$.bind(this),context:this,trigger:i,...l}),this.#t=this.#i(),this.#n=a,this.trigger=i}}disconnectedCallback(){this.#r&&this.#r.disconnect(),this.#t&&this.#t.disconnect(),this.#n&&(this.trigger({type:`disconnected->${this.id||this.tagName.toLowerCase()}`}),this.#n())}#s(a){a.forEach(i=>{if(i.nodeType===1){if(i.tagName==="SLOT"&&!H(i))return;!k.has(i)&&k.set(i,g=>{let d=me(g,i);d?this.trigger({type:d,detail:g}):i.removeEventListener(g.type,k.get(i))});let l=i.dataset.trigger;if(l){let g=de(l);for(let d of g)i.addEventListener(d,k.get(i))}}})}#i(){let a=new MutationObserver(i=>{for(let l of i)if(l.type==="attributes"){let g=l.target;g.nodeType===1&&this.#s([g])}else if(l.addedNodes.length){let g=[],d=l.addedNodes.length;for(let m=0;m<d;m++)re(l.addedNodes[m],g);this.#s(g)}});return a.observe(this.#e,{attributeFilter:[$],childList:!0,subtree:!0}),a}#o(a){!this.#e.firstChild&&this.#e.appendChild(document.importNode(a.content,!0)),a.remove()}#a(){let a=new MutationObserver(()=>{let i=this.querySelector("template[shadowrootmode]");i&&(a.disconnect(),this.#o(i))});return a.observe(this,{childList:!0}),a}$(a,i=!1){let l=`[${j}="${a}"]`;if(i){let d=[];return this.#e.querySelectorAll(l).forEach(m=>{(m.tagName!=="SLOT"||H(m))&&d.push(Object.assign(m,R))}),Object.assign(d,te)}let g=this.#e.querySelector(l);return g?g.tagName!=="SLOT"||H(g)?Object.assign(g,R):{}:{}}}))};return o.template=c=>Y(r,c),o};var fe=(e,t)=>Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every(r=>Object.hasOwn(t,r)&&e[r]===t[r]),Nt=e=>{let t=null;function r(n){if(t&&t.lastThis===this&&fe(n,t.lastProps))return t.lastResult;let s=e.call(this,n);return t={lastResult:s,lastProps:n,lastThis:this},s}return r};var qt=()=>{let e=new EventTarget;return Object.freeze({connect:(n,s)=>{let o=c=>s(c.detail);return e.addEventListener(n,o),()=>e.removeEventListener(n,o)},send:(n,s)=>{let o=new CustomEvent(n,{detail:s});e.dispatchEvent(o)}})};var Vt=(...e)=>"<!DOCTYPE html> "+e.map(t=>t.content).join("");var Gt=e=>{let t=e.startsWith("var(")?e.substring(4,e.length-5):e;return Object.freeze([()=>getComputedStyle(document.documentElement).getPropertyValue(t),(s,o=!0)=>{let c;if(typeof s=="number"&&o){let a=parseInt(getComputedStyle(document.documentElement).fontSize);c=`${s/a}rem`}document.documentElement.style.setProperty(t,c||s.toString())}])};var Zt=async(e,t,r)=>{let n=r||Q("USE_INDEXED_DB","STORE");await function(){return n("readwrite",l=>{l.put(t,e)})}();let s=i=>n("readwrite",l=>{let g=l.openCursor(e);g.onsuccess=function(){let m=this.result;if(m){let{value:p}=m;m.update(i(p));return}else console.error("cursor's value missing")}}),o=i=>n("readwrite",l=>l.put(i,e));return Object.freeze([()=>{let i;return n("readonly",l=>{i=l.get(e)}).then(()=>i.result)},i=>v(i)==="function"?s(i):o(i)])};var Yt=({context:e,trigger:t})=>{let r=({data:o})=>{t(o)},n=(o,c)=>{e.postMessage({recipient:o,detail:c})};return e.addEventListener("message",r,!1),Object.freeze({send:n,disconnect:()=>e.removeEventListener("message",r)})};var er=e=>{let t=e;return Object.freeze([()=>t,s=>{t=v(s)==="function"?s(structuredClone(t)):s}])};var rr=(...e)=>{let t={},r=(...s)=>{let o={},c=s.filter(Boolean);Object.assign(o,...c);for(let a in o)o[`--${a}`]=o[a],delete o[a];t=o};return r(...e),Object.freeze([()=>t,r])};var sr=({id:e,url:t,connect:r,send:n})=>{let s=new Worker(new URL(t,import.meta.url).href,{type:"module"}),c=r(e,i=>{s.postMessage(i)}),a=({data:i})=>{let{recipient:l,detail:g}=i;n(l,g)};return s.addEventListener("message",a,!1),()=>{c(),s.removeEventListener("message",a)}};export{mt as Fragment,K as bProgram,H as canUseSlot,Ce as classNames,Q as createIDB,Y as createTemplate,yt as css,me as getTriggerKey,Y as h,It as isle,_ as loop,de as matchAllEvents,Nt as memo,qt as messenger,C as reduceWhitespace,Vt as ssr,R as sugar,te as sugarForEach,G as sync,V as thread,Gt as useCSSVar,Zt as useIndexedDB,Yt as useMain,er as useStore,At as useSugar,rr as useTokens,sr as useWebWorker};
