var $={select:"select-event",snapshot:"state-snapshot"},O={randomized:"randomized",priority:"priority",chaos:"chaos",custom:"custom"};var _=({bids:e,selectedEvent:t})=>{let r=[];for(let n of e){let{generator:i,waitFor:s,block:c,request:a,thread:o,priority:l,trigger:d}=n,y={thread:o,priority:l},E;if(s&&Object.assign(y,{waitFor:Array.isArray(s)?s:[s]}),c&&Object.assign(y,{block:Array.isArray(c)?c:[c]}),a){let p=Array.isArray(a)?a:[a];p.some(({type:u})=>u===t.type&&l===t.priority)&&(E=t.type),Object.assign(y,{request:p})}r.push({...y,...d&&{trigger:d},...E&&{selected:E}})}return r.sort((n,i)=>n.priority-i.priority)};var z=()=>{let e=[];function t(r){for(let n in e)e[n](r)}return t.subscribe=r=>{e.push(n=>{n!==void 0&&r(n)})},t};var re=e=>{for(let t=e.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e.sort(({priority:t},{priority:r})=>t-r)[0]},ne=e=>e[Math.floor(Math.random()*Math.floor(e.length))],se=e=>e.sort(({priority:t},{priority:r})=>t-r)[0],N={[O.priority]:se,[O.chaos]:ne,[O.randomized]:re};var q=(...e)=>function*(){for(let t of e)yield*t()},B=(e,t=()=>!0)=>function*(){for(;t();)for(let r of e)yield*r()},V=e=>function*(){yield e};var W=({type:e,detail:t={}})=>({type:r,cb:n})=>n?n({detail:t,type:e}):e===r,K=({strategy:e=O.priority,dev:t}={})=>{let r=typeof e=="string"?N[e]:e,n=new Set,i=new Set,s=z();function c(){i.size&&a()}function a(){for(let p of i){let{generator:u,priority:T,thread:x,trigger:f}=p,{value:m,done:b}=u.next();!b&&n.add({thread:x,priority:T,...f&&{trigger:f},generator:u,...m}),i.delete(p)}o()}function o(){let p=[...n],u=[];for(let{request:m,priority:b}of p){if(Array.isArray(m)){u=u.concat(m.map(M=>({priority:b,...M})));continue}m&&u.push({priority:b,...m})}let T=p.flatMap(({block:m})=>m||[]),x=u.filter(m=>!T.some(W(m))),f=r(x);f&&(t&&s({kind:$.snapshot,data:_({bids:p,selectedEvent:f})}),l(f))}function l(p){for(let f of n){let{request:m=[],waitFor:b=[],generator:M}=f;[...Array.isArray(m)?m:[m],...Array.isArray(b)?b:[b]].some(W(p))&&M&&(i.add(f),n.delete(f))}let{priority:u,cb:T,...x}=p;s({kind:$.select,data:x}),c()}let d=({type:p,detail:u})=>{let T=function*(){yield{request:[{type:p,detail:u}],waitFor:[{type:"",cb:()=>!0}]}};i.add({thread:p,priority:0,trigger:!0,generator:T()}),c()},y=p=>{s.subscribe(({kind:u,data:T})=>{if(u===$.select){let{type:x,detail:f={}}=T;Object.hasOwn(p,x)&&p[x](f)}})},E=p=>{for(let u in p)i.add({thread:u,priority:i.size+1,generator:p[u]()})};return t&&s.subscribe(({kind:p,data:u})=>{p===$.snapshot&&t(u)}),Object.freeze({addThreads:E,feedback:y,trigger:d,loop:B,sync:V,thread:q})};var Ce=(...e)=>e.filter(Boolean).join(" ");var w=e=>Object.prototype.toString.call(e).slice(8,-1).toLowerCase();var oe=/[&<>'"]/g;var ie={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"};var{replace:ae}="",k=e=>ae.call(e,oe,t=>ie[t]);var G=e=>{let t=[...e].reduce((r,n)=>(r<<5)+r+n.charCodeAt(0),5381);return t===5381?null:t};var U="data-target",L="data-trigger",j=new Set(["area","base","basefont","bgsound","br","col","command","embed","frame","hr","img","isindex","input","keygen","link","menuitem","meta","nextid","param","source","track","wbr","circle","ellipse","line","path","polygon","polyline","rect","stop","use"]),Z=new Set(["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),C=new Set(["null","undefined","number","string","boolean","bigint"]);var ce=/^[a-z]+\-[a-z]+(?:\-[a-z]+)*$/,I=(e,t=[],r)=>`<${[e,...t].join(" ")}>${r.join("")}</${e}>`,X=(e,t)=>{let{shadowrootmode:r="open",children:n,shadowrootdelegatesfocus:i=!0,trusted:s,slots:c,stylesheet:a,style:o,key:l,"data-trigger":d,...y}=t;if(typeof e=="function")return e(t);let E=new Set,p=n&&Array.isArray(n)?n:n?[n]:[];if(e==="script"&&!s)throw new Error("Script tag not allowed unless 'trusted' property set");let u=e.toLowerCase(),T=[];if(d){let g=Object.entries(d).map(([h,S])=>`${h}->${S}`).join(" ");T.push(`${L}="${g}"`)}if(o){let g=Object.entries(o).map(([h,S])=>`${h.replace(/[A-Z]/g,v=>`-${v.toLowerCase()}`)}:${S};`).join(" ");T.push(`style="${k(g)}"`)}for(let g in y){if(g.startsWith("on"))throw new Error(`Event handler attributes are not allowed:  [${g}]`);let h=y[g];if(!C.has(typeof h))throw new Error(`Attributes not declared in BaseAttrs must be of type Primitive: ${g} is not primitive`);if(Z.has(g)){T.push(`${g}`);continue}let S=h??"";T.push(`${g}="${s?`${S}`:k(`${S}`)}"`)}if(typeof u=="string"&&j.has(u))return{stylesheets:E,content:`<${[u,...T].join(" ")}/>`};let x=[],f=ce.test(u),m=[],b=[];if(f){m.push(`shadowrootmode="${r}"`),a&&b.push(I("style",void 0,[a])),m.push(`shadowrootdelegatesfocus="${i}"`);let g=c?Array.isArray(c)?c:[c]:[],h=g.length;for(let S=0;S<h;S++){let v=g[S];if(typeof v=="object"&&"content"in v){x.push(v.content);continue}if(!C.has(typeof v))continue;let H=v??"";x.push(s?`${H}`:k(`${H}`))}}let M=p.length;for(let g=0;g<M;g++){let h=p[g];if(f&&typeof h=="object"&&"content"in h){b.push(h.content);continue}if(typeof h=="object"&&"content"in h){x.push(h.content);continue}if(!C.has(typeof h))continue;let S=h??"";if(f){b.push(s?`${S}`:k(`${S}`));continue}x.push(s?`${S}`:k(`${S}`))}return f&&x.unshift(I("template",m,b)),{stylesheets:E,content:I(u,T,x)}};function gt({children:e}){return e=e&&Array.isArray(e)?e:e?[e]:[],{content:e.map(t=>typeof t=="string"?t:t.content).join("")}}var R=e=>e.replace(/(\s\s+|\n)/g," "),Y=e=>w(e)==="string"||w(e)==="number",le=(e,...t)=>{let{raw:r}=e,n=t.reduce((i,s,c)=>{i+=R(r[c]);let a=Array.isArray(s)?s.filter(Y).join(""):Y(s)?s:"";return i.endsWith("$")&&(a=escape(a),i=i.slice(0,-1)),i+a},"");return n+=R(r[r.length-1])},pe=e=>{let t=/\.(-?[_a-zA-Z]+[_a-zA-Z0-9-]*)/gm,r=[],n=0,i;for(;(i=t.exec(e))!==null;)i.index>n&&r.push(e.substring(n,i.index)),r.push({content:i[1]}),n=t.lastIndex;return n<e.length&&r.push(e.substring(n)),r},ht=(e,...t)=>{let r=le(e,...t),n=btoa(`${G(r)}`).replace(/[+/=]/g,""),i=pe(r),s=new Map,c=o=>{let l=`${o}_${n.slice(0,6)}`,d=`.${l}`;return s.has(o)||s.set(o,l),d},a=i?.map(o=>typeof o=="string"?R(o):c(o.content)).join("")||"";return{classes:Object.fromEntries(s),styles:R(a).trim()}};var J=(e,t)=>{let r=new Promise((n,i)=>{let s=indexedDB.open(e);s.onerror=()=>i(s.error),s.onsuccess=()=>n(s.result),s.onupgradeneeded=()=>{!s.result.objectStoreNames.contains(t)&&s.result.createObjectStore(t)}});return(n,i)=>r.then(s=>new Promise((c,a)=>{let o=s.transaction(t,n);o.oncomplete=()=>c(),o.onabort=o.onerror=()=>a(o.error),i(o.objectStore(t))}))};var Q=({id:e,connect:t,dev:r,strategy:n,context:i})=>{let{trigger:s,...c}=K({strategy:n,dev:r}),a;if(t){let o=i.tagName.toLowerCase(),l=i.id;e&&!l&&console.error(`island ${o} is missing an id attribute and cannot communicate with messenger`),a=t(e&&l?l:o,s),s({type:`connected->${e?l??`${o} with missing id`:o}`})}return{trigger:s,disconnect:a,...c}};var F=class{constructor(t){this.callback=t}handleEvent(t){this.callback(t)}},D=new WeakMap,A=Object.freeze({set:(e,t)=>{D.set(e,new F(t))},get:e=>D.get(e),has:e=>D.has(e)});var P={render(e,t){let r=this,n=document.createElement("template");return n.innerHTML=e.content,t?(r.insertAdjacentElement(t,n),n.replaceWith(n.content.cloneNode(!0)),r):(r.replaceChildren(n.content.cloneNode(!0)),r)},replace(e){let t=this,r=document.createElement("template");r.innerHTML=e.content,console.log({element:t,clone:r.content.cloneNode(!0).childNodes}),t.replaceWith(...r.content.cloneNode(!0).childNodes)},attr(e,t){let r=this;return t===void 0?r.getAttribute(e):(t==null?r.removeAttribute(e):r.setAttribute(e,t),r)}},ee={render(e,t){let r=this;return r.forEach(n=>n.render(e,t)),r},replace(e){let t=this;return t.forEach(r=>r.replace(e)),t},attr(e,t){let r=this;return typeof e=="string"?r.forEach(n=>n.attr(e,t)):r.forEach(n=>Object.entries(e).forEach(([i,s])=>n.attr(i,s))),r}},ue=(e,t,r)=>{let n=document.createElement("template");return n.innerHTML=t.content,r?(e.insertAdjacentElement(r,n),n.replaceWith(n.content.cloneNode(!0)),e):(e.replaceChildren(n.content.cloneNode(!0)),e)};var de=e=>{let t=/(^\w+|(?:\s)\w+)(?:->)/g;return[...e.matchAll(t)].flatMap(([,r])=>r)},ge=(e,t)=>{let r=e.currentTarget===t||e.composedPath().find(c=>c?.tagName==="SLOT"&&c===t)?t:void 0;if(!r)return"";let n=`${e.type}->`,s=(r.dataset.trigger??"").trim().split(/\s+/).find(c=>c.includes(n));return s?s.replace(n,""):""},te=e=>!e.hasAttribute("slot")&&e.hasAttribute("name"),Rt=({mode:e="open",delegatesFocus:t=!0,tag:r,...n},i=s=>class extends s{})=>{let s=()=>{if(customElements.get(r)){console.error(`${r} already defined`);return}customElements.define(r,i(class extends HTMLElement{constructor(){super();this.internals_=this.attachInternals(),!this.internals_.shadowRoot&&this.attachShadow({mode:e,delegatesFocus:t}),Object.assign(this,P)}#e;#t;#r;connectedCallback(){if(!this.internals_.shadowRoot?.firstChild){let a=this.querySelector("template[shadowrootmode]");a?this.#s(a):this.#t=this.#i()}if(this.plait){this.internals_.shadowRoot&&this.#n(this.internals_.shadowRoot.querySelectorAll(`[${L}]`));let{disconnect:a,trigger:o,...l}=Q({context:this,...n});this.plait({$:this.$.bind(this),context:this,trigger:o,...l}),this.#e=this.#o(),this.#r=a,this.trigger=o}}disconnectedCallback(){this.#t&&this.#t.disconnect(),this.#e&&this.#e.disconnect(),this.#r&&(this.trigger({type:`disconnected->${this.id||this.tagName.toLowerCase()}`}),this.#r())}#n(a){a.forEach(o=>{if(o.nodeType===1){if(o.tagName==="SLOT"&&!te(o))return;!A.has(o)&&A.set(o,d=>{let y=ge(d,o);y?this.trigger({type:y,detail:d}):o.removeEventListener(d.type,A.get(o))});let l=o.dataset.trigger;if(l){let d=de(l);for(let y of d)o.addEventListener(y,A.get(o))}}})}#o(){let a=new MutationObserver(o=>{for(let l of o)l.addedNodes.length&&this.#n(l.addedNodes),l.type==="attributes"&&this.internals_.shadowRoot&&this.#n(this.internals_.shadowRoot.querySelectorAll(`[${L}]`))});return this.internals_.shadowRoot&&a.observe(this.internals_.shadowRoot,{attributeFilter:[L],childList:!0,subtree:!0}),a}#s(a){this.internals_.shadowRoot&&(!this.internals_.shadowRoot.firstChild&&this.internals_.shadowRoot.appendChild(document.importNode(a.content,!0)),a.remove())}#i(){let a=new MutationObserver(()=>{let o=this.querySelector("template[shadowrootmode]");o&&(a.disconnect(),this.#s(o))});return a.observe(this,{childList:!0}),a}$(a){let o=[];return this.internals_.shadowRoot&&this.internals_.shadowRoot.querySelectorAll(`[${U}="${a}"]`).forEach(l=>{if(l.tagName==="SLOT"){te(l)&&(Object.assign(l,P),o.push(l));return}Object.assign(l,P),o.push(l)}),Object.assign(o,ee),o}}))};return s.template=c=>X(r,c),s};var me=(e,t)=>Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every(r=>Object.hasOwn(t,r)&&e[r]===t[r]),Ft=e=>{let t=null;function r(n){if(t&&t.lastThis===this&&me(n,t.lastProps))return t.lastResult;let i=e.call(this,n);return t={lastResult:i,lastProps:n,lastThis:this},i}return r};var _t=()=>{let e=new EventTarget;return Object.freeze({connect:(n,i)=>{let s=c=>i(c.detail);return e.addEventListener(n,s),()=>e.removeEventListener(n,s)},send:(n,i)=>{let s=new CustomEvent(n,{detail:i});e.dispatchEvent(s)}})};var Nt=(...e)=>"<!DOCTYPE html> "+e.map(t=>t.content).join("");var Bt=e=>{let t=e.startsWith("var(")?e.substring(4,e.length-5):e;return Object.freeze([()=>getComputedStyle(document.documentElement).getPropertyValue(t),(i,s=!0)=>{let c;if(typeof i=="number"&&s){let a=parseInt(getComputedStyle(document.documentElement).fontSize);c=`${i/a}rem`}document.documentElement.style.setProperty(t,c||i.toString())}])};var Ut=async(e,t,r)=>{let n=r||J("USE_INDEXED_DB","STORE");await function(){return n("readwrite",l=>{l.put(t,e)})}();let i=o=>n("readwrite",l=>{let d=l.openCursor(e);d.onsuccess=function(){let E=this.result;if(E){let{value:p}=E;E.update(o(p));return}else console.error("cursor's value missing")}}),s=o=>n("readwrite",l=>l.put(o,e));return Object.freeze([()=>{let o;return n("readonly",l=>{o=l.get(e)}).then(()=>o.result)},o=>w(o)==="function"?i(o):s(o)])};var Zt=({context:e,trigger:t})=>{let r=({data:s})=>{t(s)},n=(s,c)=>{e.postMessage({recipient:s,detail:c})};return e.addEventListener("message",r,!1),Object.freeze({send:n,disconnect:()=>e.removeEventListener("message",r)})};var Jt=e=>{let t=e;return Object.freeze([()=>t,i=>{t=w(i)==="function"?i(structuredClone(t)):i}])};var er=(...e)=>{let t={},r=(...i)=>{let s={},c=i.filter(Boolean);Object.assign(s,...c);for(let a in s)s[`--${a}`]=s[a],delete s[a];t=s};return r(...e),Object.freeze([()=>t,r])};var rr=({id:e,url:t,connect:r,send:n})=>{let i=new Worker(new URL(t,import.meta.url).href,{type:"module"}),c=r(e,o=>{i.postMessage(o)}),a=({data:o})=>{let{recipient:l,detail:d}=o;n(l,d)};return i.addEventListener("message",a,!1),()=>{c(),i.removeEventListener("message",a)}};export{gt as Fragment,K as bProgram,te as canUseSlot,Ce as classNames,J as createIDB,X as createTemplate,ht as css,ge as getTriggerKey,X as h,Rt as isle,B as loop,de as matchAllEvents,Ft as memo,_t as messenger,R as reduceWhitespace,ue as render,Nt as ssr,V as sync,q as thread,Bt as useCSSVar,Ut as useIndexedDB,Zt as useMain,Jt as useStore,er as useTokens,rr as useWebWorker};
