var L={randomized:"randomized",priority:"priority",chaos:"chaos",custom:"custom"};var z=({bids:e,selectedEvent:t})=>{let r=[];for(let s of e){let{generator:o,waitFor:n,block:c,request:i,thread:a,priority:g,trigger:u}=s,l={thread:a,priority:g},d;if(n&&Object.assign(l,{waitFor:Array.isArray(n)?n:[n]}),c&&Object.assign(l,{block:Array.isArray(c)?c:[c]}),i){let S=Array.isArray(i)?i:[i];S.some(({type:p})=>p===t.type&&g===t.priority)&&(d=t.type),Object.assign(l,{request:S})}r.push({...l,...u&&{trigger:u},...d&&{selected:d}})}return r.sort((s,o)=>s.priority-o.priority)};var $=e=>Object.prototype.toString.call(e).slice(8,-1).toLowerCase();var ne=/[&<>'"]/g;var se={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"};var{replace:oe}="",ie=e=>se[e];var M=e=>oe.call(e,ne,ie);var O=()=>{let e=new Set;function t(r){for(let s of e)s(r)}return t.subscribe=r=>(e.add(r),()=>e.delete(r)),t};var q=e=>{let t=[...e].reduce((r,s)=>(r<<5)+r+s.charCodeAt(0),5381);return t===5381?null:t};var ae=e=>{for(let t=e.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e.sort(({priority:t},{priority:r})=>t-r)[0]},ce=e=>e[Math.floor(Math.random()*Math.floor(e.length))],le=e=>e.sort(({priority:t},{priority:r})=>t-r)[0],_={[L.priority]:le,[L.chaos]:ce,[L.randomized]:ae};var B=(...e)=>function*(){for(let t of e)yield*t()},V=(e,t=()=>!0)=>function*(){for(;t();)for(let r of e)yield*r()},G=e=>function*(){yield e};var K=({type:e,detail:t={}})=>({type:r,cb:s})=>s?s({detail:t,type:e}):e===r,U=({strategy:e=L.priority,dev:t}={})=>{let r=typeof e=="string"?_[e]:e,s=new Set,o=new Set,n=O(),c=t&&O();function i(){o.size&&a()}function a(){for(let p of o){let{generator:m,priority:T,thread:E,trigger:x}=p,{value:y,done:v}=m.next();!v&&s.add({thread:E,priority:T,...x&&{trigger:x},generator:m,...y}),o.delete(p)}g()}function g(){let p=[...s],m=[];for(let{request:y,priority:v}of p){if(Array.isArray(y)){m=m.concat(y.map(f=>({priority:v,...f})));continue}y&&m.push({priority:v,...y})}let T=p.flatMap(({block:y})=>y||[]),E=m.filter(y=>!T.some(K(y))),x=r(E);x&&(t&&c&&c(z({bids:p,selectedEvent:x})),u(x))}function u(p){for(let x of s){let{request:y=[],waitFor:v=[],generator:f}=x;[...Array.isArray(y)?y:[y],...Array.isArray(v)?v:[v]].some(K(p))&&f&&(o.add(x),s.delete(x))}let{priority:m,cb:T,...E}=p;n(E),i()}let l=({type:p,detail:m})=>{let T=function*(){yield{request:[{type:p,detail:m}],waitFor:[{type:"",cb:()=>!0}]}};o.add({thread:p,priority:0,trigger:!0,generator:T()}),i()},d=p=>{n.subscribe(m=>{let{type:T,detail:E={}}=m;Object.hasOwn(p,T)&&p[T](E)})},S=p=>{for(let m in p)o.add({thread:m,priority:o.size+1,generator:p[m]()})};return t&&c&&c.subscribe(p=>t(p)),Object.freeze({addThreads:S,feedback:d,trigger:l,loop:V,sync:G,thread:B})};var dt=(...e)=>e.filter(Boolean).join(" ");var W="data-target",C="data-trigger",j=new Set(["area","base","basefont","bgsound","br","col","command","embed","frame","hr","img","isindex","input","keygen","link","menuitem","meta","nextid","param","source","track","wbr","circle","ellipse","line","path","polygon","polyline","rect","stop","use"]),Z=new Set(["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),P=new Set(["null","undefined","number","string","boolean","bigint"]);var de=/^[a-z]+\-[a-z]+(?:\-[a-z]+)*$/,I=(e,t=[],r)=>`<${[e,...t].join(" ")}>${r.join("")}</${e}>`,X=(e,t)=>{let{shadowrootmode:r="open",children:s,shadowrootdelegatesfocus:o=!0,trusted:n,slots:c,stylesheet:i,style:a,key:g,"data-trigger":u,...l}=t;if(typeof e=="function")return e(t);let d=new Set;i&&d.add(i);let S=s&&Array.isArray(s)?s:s?[s]:[];if(e==="script"&&!n)throw new Error("Script tag not allowed unless 'trusted' property set");let p=e.toLowerCase(),m=[];if(u){let f=Object.entries(u).map(([h,b])=>`${h}->${b}`).join(" ");m.push(`${C}="${f}"`)}if(a){let f=Object.entries(a).map(([h,b])=>`${h.replace(/[A-Z]/g,w=>`-${w.toLowerCase()}`)}:${b};`).join(" ");m.push(`style="${M(f)}"`)}for(let f in l){if(f.startsWith("on"))throw new Error(`Event handler attributes are not allowed:  [${f}]`);let h=l[f];if(!P.has(typeof h))throw new Error(`Attributes not declared in BaseAttrs must be of type Primitive: ${f} is not primitive`);if(Z.has(f)){m.push(`${f}`);continue}let b=h??"";m.push(`${f}="${n?`${b}`:M(`${b}`)}"`)}if(j.has(p))return{stylesheets:d,content:`<${[p,...m].join(" ")}/>`};let T=[],E=de.test(p),x=[],y=[];E&&(x.push(`shadowrootmode="${r}"`),x.push(`shadowrootdelegatesfocus="${o}"`));let v=S.length;for(let f=0;f<v;f++){let h=S[f];if(E&&typeof h=="object"&&"content"in h){y.push(h.content);for(let w of h.stylesheets)d.add(w);continue}if(typeof h=="object"&&"content"in h){T.push(h.content);for(let w of h.stylesheets)d.add(w);continue}if(!P.has(typeof h))continue;let b=h??"";if(E){y.push(n?`${b}`:M(`${b}`));continue}T.push(n?`${b}`:M(`${b}`))}if(E){d.size&&y.unshift(I("style",void 0,[...d])),T.unshift(I("template",x,y)),d.clear();let f=c?Array.isArray(c)?c:[c]:[],h=f.length;for(let b=0;b<h;b++){let w=f[b];if(typeof w=="object"&&"content"in w){T.push(w.content);for(let re of w.stylesheets)d.add(re);continue}if(!P.has(typeof w))continue;let N=w??"";T.push(n?`${N}`:M(`${N}`))}}return{stylesheets:d,content:I(p,m,T)}};function ft({children:e}){e=e&&Array.isArray(e)?e:e?[e]:[];let t="",r=new Set,s=e.length;for(let o=0;o<s;o++){let n=e[o];if(typeof n=="string"){t+=n;continue}t+=n.content;for(let c of n.stylesheets)r.add(c)}return{content:t,stylesheets:r}}var k=e=>e.replace(/(\s\s+|\n)/g," "),J=e=>$(e)==="string"||$(e)==="number",ge=(e,...t)=>{let{raw:r}=e,s=t.reduce((o,n,c)=>{o+=k(r[c]);let i=Array.isArray(n)?n.filter(J).join(""):J(n)?n:"";return o.endsWith("$")&&(i=escape(i),o=o.slice(0,-1)),o+i},"");return s+=k(r[r.length-1])},ue=e=>{let t=/\.(-?[_a-zA-Z]+[_a-zA-Z0-9-]*)/gm,r=[],s=0,o;for(;(o=t.exec(e))!==null;)o.index>s&&r.push(e.substring(s,o.index)),r.push({content:o[1]}),s=t.lastIndex;return s<e.length&&r.push(e.substring(s)),r},Tt=(e,...t)=>{let r=ge(e,...t),s=btoa(`${q(r)}`).replace(/[+/=]/g,""),o=ue(r),n=new Map,c=a=>{let g=`${a}_${s.slice(0,6)}`,u=`.${g}`;return n.has(a)||n.set(a,g),u},i=o?.map(a=>typeof a=="string"?k(a):c(a.content)).join("")||"";return Object.freeze([Object.fromEntries(n),{stylesheet:k(i).trim()}])};var Q=({id:e,connect:t,dev:r,strategy:s,context:o})=>{let{trigger:n,...c}=U({strategy:s,dev:r}),i;if(t){let a=o.tagName.toLowerCase(),g=o.id;e&&!g&&console.error(`island ${a} is missing an id attribute and cannot communicate with messenger`),i=t(e&&g?g:a,n),n({type:`connected->${e?g??`${a} with missing id`:a}`})}return{trigger:n,disconnect:i,...c}};var F=class{constructor(t){this.callback=t}handleEvent(t){this.callback(t)}},D=new WeakMap,A=Object.freeze({set:(e,t)=>{D.set(e,new F(t))},get:e=>D.get(e),has:e=>D.has(e)});var R={render({stylesheets:e,content:t},r){let s=this,o=document.createElement("template");return o.innerHTML=[...e].join("")+t,r?(s.insertAdjacentElement(r,o),o.replaceWith(o.content),s):(s.replaceChildren(o.content),s)},replace({stylesheets:e,content:t}){let r=this,s=document.createElement("template");s.innerHTML=[...e].join("")+t,r.replaceWith(s.content)},attr(e,t){let r=this;return t===void 0?r.getAttribute(e):(t==null?r.removeAttribute(e):r.setAttribute(e,t),r)}},Y={render(e,t){let r=this;return r.forEach((s,o)=>s.render(e[o],t)),r},replace(e){let t=this;return t.forEach((r,s)=>r.replace(e[s])),t},attr(e,t){let r=this;return typeof e=="string"?r.forEach(s=>s.attr(e,t)):r.forEach(s=>Object.entries(e).forEach(([o,n])=>s.attr(o,n))),r}},Lt=e=>Object.assign(e,R);var pe=e=>{let t=/(^\w+|(?:\s)\w+)(?:->)/g;return[...e.matchAll(t)].flatMap(([,r])=>r)},me=(e,t)=>{let r=e.currentTarget===t||e.composedPath().find(c=>c?.tagName==="SLOT"&&c===t)?t:void 0;if(!r)return"";let s=`${e.type}->`,n=(r.dataset.trigger??"").trim().split(/\s+/).find(c=>c.includes(s));return n?n.replace(s,""):""},H=e=>!e.hasAttribute("slot")&&e.hasAttribute("name"),ee=(e,t)=>{if(e.nodeType===1&&(e.hasAttribute("data-trigger")&&t.push(e),e.hasChildNodes())){let r=e.childNodes,s=r.length;for(let o=0;o<s;o++)ee(r[o],t)}},It=({mode:e="open",delegatesFocus:t=!0,tag:r,...s},o=n=>class extends n{})=>{let n=()=>{if(customElements.get(r)){console.error(`${r} already defined`);return}customElements.define(r,o(class extends HTMLElement{constructor(){super();if(this.internals_=this.attachInternals(),this.internals_.shadowRoot?this.#e=this.internals_.shadowRoot:this.#e=this.attachShadow({mode:e,delegatesFocus:t}),this.trigger!==this.constructor.prototype.trigger)throw new Error("trigger cannot be overridden in a subclass.")}#t;#r;#n;#e;connectedCallback(){if(!this.internals_.shadowRoot?.firstChild){let i=this.querySelector("template[shadowrootmode]");i?this.#o(i):this.#r=this.#a()}if(this.plait){this.#s(this.#e.querySelectorAll(`[${C}]`));let{disconnect:i,trigger:a,...g}=Q({context:this,...s});this.plait({$:this.$.bind(this),context:this,trigger:a,...g}),this.#t=this.#i(),this.#n=i,this.trigger=a}}disconnectedCallback(){this.#r&&this.#r.disconnect(),this.#t&&this.#t.disconnect(),this.#n&&(this.trigger({type:`disconnected->${this.id||this.tagName.toLowerCase()}`}),this.#n())}#s(i){i.forEach(a=>{if(a.nodeType===1){if(a.tagName==="SLOT"&&!H(a))return;!A.has(a)&&A.set(a,u=>{let l=me(u,a);l?this.trigger({type:l,detail:u}):a.removeEventListener(u.type,A.get(a))});let g=a.dataset.trigger;if(g){let u=pe(g);for(let l of u)a.addEventListener(l,A.get(a))}}})}#i(){let i=new MutationObserver(a=>{for(let g of a)if(g.type==="attributes"){let u=g.target;u.nodeType===1&&this.#s([u])}else if(g.addedNodes.length){let u=[],l=g.addedNodes.length;for(let d=0;d<l;d++)ee(g.addedNodes[d],u);this.#s(u)}});return i.observe(this.#e,{attributeFilter:[C],childList:!0,subtree:!0}),i}#o(i){!this.#e.firstChild&&this.#e.appendChild(document.importNode(i.content,!0)),i.remove()}#a(){let i=new MutationObserver(()=>{let a=this.querySelector("template[shadowrootmode]");a&&(i.disconnect(),this.#o(a))});return i.observe(this,{childList:!0}),i}$(i,{all:a=!1,mod:g="="}={}){let u=`[${W}${g}"${i}"]`;if(a){let d=[];return this.#e.querySelectorAll(u).forEach(S=>{(S.tagName!=="SLOT"||H(S))&&d.push(Object.assign(S,R))}),Object.assign(d,Y)}let l=this.#e.querySelector(u);if(l&&(l.tagName!=="SLOT"||H(l)))return Object.assign(l,R)}}))};return n.template=c=>X(r,c),n};var fe=(e,t)=>Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every(r=>Object.hasOwn(t,r)&&e[r]===t[r]),Nt=e=>{let t=null;function r(s){if(t&&t.lastThis===this&&fe(s,t.lastProps))return t.lastResult;let o=e.call(this,s);return t={lastResult:o,lastProps:s,lastThis:this},o}return r};var qt=(...e)=>{let t="",r=new Set,s=e.length;for(let u=0;u<s;u++){let l=e[u];if(typeof l=="string"){t+=l;continue}t+=l.content;for(let d of l.stylesheets)r.add(d)}let o=r.size?`<style>${[...r].join("")}</style>`:"",n=t.indexOf("</head>"),i=/<body\b[^>]*>/i.exec(t),a=i?i.index+i[0].length:0,g=n!==-1?n:a;return t.slice(0,g)+o+t.slice(g)};var Bt=e=>{let t=e.startsWith("var(")?e.substring(4,e.length-5):e;return Object.freeze([()=>getComputedStyle(document.documentElement).getPropertyValue(t),(o,n=!0)=>{let c;if(typeof o=="number"&&n){let i=parseInt(getComputedStyle(document.documentElement).fontSize);c=`${o/i}rem`}document.documentElement.style.setProperty(t,c||o.toString())}])};var te=(e,t)=>{let r=new Promise((s,o)=>{let n=indexedDB.open(e);n.onerror=()=>o(n.error),n.onsuccess=()=>s(n.result),n.onupgradeneeded=()=>{!n.result.objectStoreNames.contains(t)&&n.result.createObjectStore(t)}});return(s,o)=>r.then(n=>new Promise((c,i)=>{let a=n.transaction(t,s);a.oncomplete=()=>c(),a.onabort=a.onerror=()=>i(a.error),o(a.objectStore(t))}))};var Wt=async(e,t,r)=>{let s=r?.databaseName??"USE_INDEXED_DB",o=r?.storeName??"STORE",n=te(s,o),c=new BroadcastChannel(`${s}_${o}_${e}`);await function(){return n("readwrite",d=>{d.put(t,e)})}();let i=l=>n("readwrite",d=>{let S=d.openCursor(e);S.onsuccess=function(){let m=this.result;if(m){let{value:T}=m;m.update(l(T));return}else console.error("cursor's value missing")}}),a=l=>n("readwrite",d=>d.put(l,e)),g=async l=>{await $(l)==="function"?i(l):a(l);let d=await u();c.postMessage(d)},u=()=>{let l;return n("readonly",d=>{l=d.get(e)}).then(()=>l.result)};return u.subscribe=l=>{let d=new BroadcastChannel(`${s}_${o}_${e}`),S=p=>{l(p.data)};return d.addEventListener("message",S),()=>d.removeEventListener("message",S)},Object.freeze([u,g])};var Zt=(e,t)=>{let r=({data:n})=>{t(n)},s=(n,c)=>{e.postMessage({recipient:n,detail:c})};return e.addEventListener("message",r,!1),Object.freeze([s,()=>e.removeEventListener("message",r)])};var Jt=()=>{let e=new EventTarget,t=(s,o)=>{let n=c=>o(c.detail);return e.addEventListener(s,n),()=>e.removeEventListener(s,n)};t.worker=(s,o)=>{let n=new Worker(new URL(o,import.meta.url).href,{type:"module"}),i=t(s,g=>{n.postMessage(g)}),a=({data:g})=>{let{recipient:u,detail:l}=g;r(u,l)};return n.addEventListener("message",a,!1),()=>{i(),n.removeEventListener("message",a)}};let r=(s,o)=>{let n=new CustomEvent(s,{detail:o});e.dispatchEvent(n)};return Object.freeze([t,r])};var er=e=>{let t=e,r,s=()=>t;return s.subscribe=n=>(r=r??O(),r.subscribe(n)),Object.freeze([s,n=>{t=$(n)==="function"?n(structuredClone(t)):n,r&&r(t)}])};var rr=(...e)=>{let t={},r=(...o)=>{let n={},c=o.filter(Boolean);Object.assign(n,...c);for(let i in n)n[`--${i}`]=n[i],delete n[i];t=n};return r(...e),Object.freeze([()=>t,r])};export{ft as Fragment,U as bProgram,H as canUseSlot,dt as classNames,X as createTemplate,Tt as css,me as getTriggerKey,X as h,It as isle,V as loop,pe as matchAllEvents,Nt as memo,k as reduceWhitespace,qt as ssr,R as sugar,Y as sugarForEach,G as sync,B as thread,Bt as useCSSVar,Wt as useIndexedDB,Zt as useMain,Jt as useMessenger,er as useStore,Lt as useSugar,rr as useTokens};
