var w={select:"select-event",snapshot:"state-snapshot"},v={randomized:"randomized",priority:"priority",chaos:"chaos",custom:"custom"};var R=({bids:e,selectedEvent:t})=>{let r=[];for(let s of e){let{generator:o,waitFor:n,block:a,request:c,thread:i,priority:l,trigger:d}=s,S={thread:i,priority:l},f;if(n&&Object.assign(S,{waitFor:Array.isArray(n)?n:[n]}),a&&Object.assign(S,{block:Array.isArray(a)?a:[a]}),c){let p=Array.isArray(c)?c:[c];p.some(({type:g})=>g===t.type&&l===t.priority)&&(f=t.type),Object.assign(S,{request:p})}r.push({...S,...d&&{trigger:d},...f&&{selected:f}})}return r.sort((s,o)=>s.priority-o.priority)};var A=()=>{let e=[];function t(r){for(let s in e)e[s](r)}return t.subscribe=r=>{e.push(s=>{s!==void 0&&r(s)})},t};var Q=e=>{for(let t=e.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e.sort(({priority:t},{priority:r})=>t-r)[0]},Y=e=>e[Math.floor(Math.random()*Math.floor(e.length))],j=e=>e.sort(({priority:t},{priority:r})=>t-r)[0],F={[v.priority]:j,[v.chaos]:Y,[v.randomized]:Q};var D=(...e)=>function*(){for(let t of e)yield*t()},z=(e,t=()=>!0)=>function*(){for(;t();)for(let r of e)yield*r()},H=e=>function*(){yield e};var q=({type:e,detail:t={}})=>({type:r,cb:s})=>s?s({detail:t,type:e}):e===r,W=({strategy:e=v.priority,dev:t}={})=>{let r=typeof e=="string"?F[e]:e,s=new Set,o=new Set,n=A();function a(){o.size&&c()}function c(){for(let p of o){let{generator:g,priority:h,thread:y,trigger:m}=p,{value:u,done:T}=g.next();!T&&s.add({thread:y,priority:h,...m&&{trigger:m},generator:g,...u}),o.delete(p)}i()}function i(){let p=[...s],g=[];for(let{request:u,priority:T}of p){if(Array.isArray(u)){g=g.concat(u.map(C=>({priority:T,...C})));continue}u&&g.push({priority:T,...u})}let h=p.flatMap(({block:u})=>u||[]),y=g.filter(u=>!h.some(q(u))),m=r(y);m&&(t&&n({kind:w.snapshot,data:R({bids:p,selectedEvent:m})}),l(m))}function l(p){for(let m of s){let{request:u=[],waitFor:T=[],generator:C}=m;[...Array.isArray(u)?u:[u],...Array.isArray(T)?T:[T]].some(q(p))&&C&&(o.add(m),s.delete(m))}let{priority:g,cb:h,...y}=p;n({kind:w.select,data:y}),a()}let d=({type:p,detail:g})=>{let h=function*(){yield{request:[{type:p,detail:g}],waitFor:[{type:"",cb:()=>!0}]}};o.add({thread:p,priority:0,trigger:!0,generator:h()}),a()},S=p=>{n.subscribe(({kind:g,data:h})=>{if(g===w.select){let{type:y,detail:m={}}=h;Object.hasOwn(p,y)&&p[y](m)}})},f=p=>{for(let g in p)o.add({thread:g,priority:o.size+1,generator:p[g]()})};return t&&n.subscribe(({kind:p,data:g})=>{p===w.snapshot&&t(g)}),Object.freeze({addThreads:f,feedback:S,trigger:d,loop:z,sync:H,thread:D})};var be=(...e)=>e.filter(Boolean).join(" ");var x=e=>Object.prototype.toString.call(e).slice(8,-1).toLowerCase();var ee=/[&<>'"]/g;var te={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"};var{replace:re}="",_=e=>re.call(e,ee,t=>te[t]);var B=e=>{let t=[...e].reduce((r,s)=>(r<<5)+r+s.charCodeAt(0),5381);return t===5381?null:t};var N=e=>{let t=/(^\w+|(?:\s)\w+)(?:->)/g;return[...e.matchAll(t)].flatMap(([,r])=>r)},U=({currentTarget:e,composedPath:t,type:r},s)=>{let o=e===s||t().find(i=>i instanceof HTMLSlotElement)===s?s:void 0;if(!o)return"";let n=`${r}->`,c=(o.dataset.trigger??"").trim().split(/\s+/).find(i=>i.includes(n));return c?c.replace(n,""):""},M=e=>!e.hasAttribute("slot")&&e.hasAttribute("name"),V=e=>{let t=[];return e.forEach(r=>{if(r instanceof HTMLElement||r instanceof SVGElement){if(r instanceof HTMLSlotElement&&!M(r))return;r.dataset.trigger&&t.push(r)}}),t},E=e=>e.replace(/(\s\s+|\n)/g," "),K=e=>x(e)==="string"||x(e)==="number",$=(e,...t)=>{let{raw:r}=e,s=t.reduce((o,n,a)=>{o+=E(r[a]);let c=Array.isArray(n)?n.filter(K).join(""):K(n)?n:"";return o.endsWith("$")&&(c=_(c),o=o.slice(0,-1)),o+c},"");return s+=E(r[r.length-1])};var ne=e=>{let t=/\.(-?[_a-zA-Z]+[_a-zA-Z0-9-]*)/gm,r=[],s=0,o;for(;(o=t.exec(e))!==null;)o.index>s&&r.push(e.substring(s,o.index)),r.push({content:o[1]}),s=t.lastIndex;return s<e.length&&r.push(e.substring(s)),r},it=(e,...t)=>{let r=$(e,...t),s=btoa(`${B(r)}`).replace(/[+/=]/g,""),o=ne(r),n=new Map,a=i=>{let l=`${i}_${s.slice(0,6)}`,d=`.${l}`;return n.has(i)||n.set(i,l),d},c=o?.map(i=>typeof i=="string"?E(i):a(i.content)).join("")||"";return{classes:Object.fromEntries(n),styles:E(c).trim()}};var ct=(e,t,r=!0)=>{let s=e.startsWith("var(")?e.substring(4,e.length-5):e,o;if(typeof t=="number"&&r){let n=parseInt(getComputedStyle(document.documentElement).fontSize);o=`${t/n}rem`}return t&&document.documentElement.style.setProperty(s,o||t.toString()),getComputedStyle(document.documentElement).getPropertyValue(s)};var k="data-target",P="data-trigger";var G=({id:e,connect:t,dev:r,strategy:s,context:o})=>{let{trigger:n,...a}=W({strategy:s,dev:r}),c;if(t){let i=o.tagName.toLowerCase(),l=o.id;e&&!l&&console.error(`island ${i} is missing an id attribute and cannot communicate with messenger`),c=t(e&&l?l:i,n),n({type:`connected->${e?l??`${i} with missing id`:i}`})}return{trigger:n,disconnect:c,...a}};var L=class{callback;constructor(t){this.callback=t}handleEvent(t){this.callback(t)}},I=new WeakMap,O=Object.freeze({set:(e,t)=>{I.set(e,new L(t))},get:e=>I.get(e),has:e=>I.has(e)});var vt=({mode:e="open",delegatesFocus:t=!0,tag:r,...s},o)=>class extends o{#s=!1;#e;#t;#r;internals_;#n;constructor(){super(),this.internals_=this.attachInternals();let n=this.internals_.shadowRoot;!n&&(n=this.attachShadow({mode:e,delegatesFocus:t})),!n.firstChild&&(this.#s=!0)}connectedCallback(){if(super.connectedCallback&&super.connectedCallback(),this.#s){let i=this.querySelector("template[shadowrootmode]");i?this.#a(i):this.#t=this.#l()}this.#o(),this.#e=this.#c();let{disconnect:n,trigger:a,...c}=G({context:this,...s});this.plait({$:this.$.bind(this),context:this,trigger:a,...c}),this.#r=n,this.#n=a}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback(),this.#t&&this.#t.disconnect(),this.#e&&this.#e.disconnect(),this.#r&&(this.#n({type:`disconnected->${this.id||this.tagName.toLowerCase()}`}),this.#r())}#o(){let n=this.internals_.shadowRoot;if(n){let a=[...n.querySelectorAll(`[${P}]`)].filter(c=>c instanceof HTMLSlotElement?M(c):!0);a.length&&this.#i(a)}}#i(n){n.forEach(a=>{!O.has(a)&&O.set(a,i=>{let l=U(i,a);l?this.#n({type:l,detail:i}):a.removeEventListener(i.type,O.get(a))});let c=a.dataset.trigger;if(c){let i=N(c);for(let l of i)a.addEventListener(l,O.get(a))}})}#c(){let n=this.internals_.shadowRoot;if(n){let a=new MutationObserver(c=>{for(let i of c){if(i.addedNodes.length){let l=V(i.addedNodes);l.length&&this.#i(l)}i.type==="attributes"&&this.#o()}});return a.observe(n,{attributeFilter:[P],childList:!0,subtree:!0}),a}}#a(n){let a=this.internals_.shadowRoot;a&&(!a.firstChild&&a.appendChild(document.importNode(n.content,!0)),n.remove())}#l(){let n=new MutationObserver(()=>{let a=this.querySelector("template[shadowrootmode]");a&&(n.disconnect(),this.#a(a))});return n.observe(this,{childList:!0}),n}$(n){let a=this.internals_.shadowRoot,c=[];return a&&(c=[...a.querySelectorAll(`[${k}="${n}"]`)].filter(i=>i instanceof HTMLSlotElement?M(i):!0)),c}static define(){customElements.get(r)||customElements.define(r,this)}};var b=(e,...t)=>$(e,...t).trim().replace(/[\s\n]+>/g,">").replace(/(<.*?)(?:\s+)(\w)|>\s+</g,(o,n,a)=>n?[n,a].join(" "):"><").replace(/(>)(?:\s)(\S)|(\S)(?:\s)(<)/g,(o,n,a,c,i)=>n?[n,a].join(""):[c,i].join(""));var Z=e=>{let t=[];for(let r in e){let s=e[r];if(s!=null){if(r==="target"){t.push(`${k}="${s}"`);continue}if(r==="triggers"){t.push(`${P}="${Object.entries(s).map(([o,n])=>`${o}->${n}`).join(" ")}"`);continue}if(r==="className"){t.push(`class="${s}"`);continue}if(r==="htmlFor"){t.push(`for="${s}"`);continue}if(!(!r.startsWith("aria")&&!s)){if(!r.startsWith("aria")&&typeof s=="boolean"){t.push(b`$${r}`);continue}t.push(b`${r}="$${s?.toString()}"`)}}}return t.join(" ")};var se=(e,t)=>Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every(r=>Object.hasOwn(t,r)&&e[r]===t[r]),X=e=>{let t=null;function r(s){if(t&&t.lastThis===this&&se(s,t.lastProps))return t.lastResult;let o=e.call(this,s);return t={lastResult:o,lastProps:s,lastThis:this},o}return r.styles=new Set,r};var Ft=X(({tag:e,template:t,mode:r="open",delegatesFocus:s=!0,slots:o,styles:n,...a})=>{let c=n&&b`<style>${typeof n=="string"?n:[...n]}</style>`;return b`
  <${e} ${Z({...a})}>
    <template
      shadowrootmode="${r}"
      ${s&&"shadowrootdelegatesfocus"}
    >
      ${c}
      ${t}
    </template>
    ${o}
  </${e}>
  `});var zt=(...e)=>{let t=e.filter(Boolean),r={};Object.assign(r,...t);for(let s in r)r[`--${s}`]=r[s],delete r[s];return r};var J=(e,t)=>{let r=new Promise((s,o)=>{let n=indexedDB.open(e);n.onerror=()=>o(n.error),n.onsuccess=()=>s(n.result),n.onupgradeneeded=()=>{!n.result.objectStoreNames.contains(t)&&n.result.createObjectStore(t)}});return(s,o)=>r.then(n=>new Promise((a,c)=>{let i=n.transaction(t,s);i.oncomplete=()=>a(),i.onabort=i.onerror=()=>c(i.error),o(i.objectStore(t))}))};var Wt=()=>{let e=new EventTarget;return Object.freeze({connect:(s,o)=>{let n=a=>o(a.detail);return e.addEventListener(s,n),()=>e.removeEventListener(s,n)},send:(s,o)=>{let n=new CustomEvent(s,{detail:o});e.dispatchEvent(n)}})};var Ut=async(e,t,r)=>{let s=r||J("USE_INDEXED_DB","STORE");await function(){return s("readwrite",l=>{l.put(t,e)})}();let o=i=>s("readwrite",l=>{let d=l.openCursor(e);d.onsuccess=function(){let f=this.result;if(f){let{value:p}=f;f.update(i(p));return}else console.error("cursor's value missing")}}),n=i=>s("readwrite",l=>l.put(i,e));return Object.freeze([()=>{let i;return s("readonly",l=>{i=l.get(e)}).then(()=>i.result)},i=>x(i)==="function"?o(i):n(i)])};var Gt=({context:e,trigger:t})=>{let r=({data:n})=>{t(n)},s=(n,a)=>{e.postMessage({recipient:n,detail:a})};return e.addEventListener("message",r,!1),Object.freeze({send:s,disconnect:()=>e.removeEventListener("message",r)})};var Jt=e=>{let t=e;return Object.freeze([()=>t,o=>{t=x(o)==="function"?o(t):o}])};var Yt=({id:e,url:t,connect:r,send:s})=>{let o=new Worker(new URL(t,import.meta.url).href,{type:"module"}),a=r(e,i=>{o.postMessage(i)}),c=({data:i})=>{let{recipient:l,detail:d}=i;s(l,d)};return o.addEventListener("message",c,!1),()=>{a(),o.removeEventListener("message",c)}};var er=({el:e,template:t,position:r="beforeend"})=>{let s=new DOMParser().parseFromString(t,"text/html",{includeShadowRoots:!0});e?.insertAdjacentElement(r,s.body.firstChild)};export{Ft as IslandTemplate,W as bProgram,be as classNames,J as createIDB,it as css,ct as cssVar,k as dataTarget,P as dataTrigger,b as html,er as insertIsland,vt as isle,z as loop,Wt as messenger,H as sync,X as template,D as thread,zt as tokens,Ut as useIndexedDB,Gt as useMain,Jt as useStore,Yt as useWebWorker,Z as wire};
