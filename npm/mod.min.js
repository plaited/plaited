var E={select:"select-event",snapshot:"state-snapshot"},v={randomized:"randomized",priority:"priority",chaos:"chaos",custom:"custom"};var k=({bids:e,selectedEvent:t})=>{let r=[];for(let n of e){let{generator:o,waitFor:s,block:c,request:a,thread:i,priority:l,trigger:u}=n,m={thread:i,priority:l},f;if(s&&Object.assign(m,{waitFor:Array.isArray(s)?s:[s]}),c&&Object.assign(m,{block:Array.isArray(c)?c:[c]}),a){let p=Array.isArray(a)?a:[a];p.some(({type:d})=>d===t.type&&l===t.priority)&&(f=t.type),Object.assign(m,{request:p})}r.push({...m,...u&&{trigger:u},...f&&{selected:f}})}return r.sort((n,o)=>n.priority-o.priority)};var D=()=>{let e=[];function t(r){for(let n in e)e[n](r)}return t.subscribe=r=>{e.push(n=>{n!==void 0&&r(n)})},t};var Y=e=>{for(let t=e.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e.sort(({priority:t},{priority:r})=>t-r)[0]},j=e=>e[Math.floor(Math.random()*Math.floor(e.length))],ee=e=>e.sort(({priority:t},{priority:r})=>t-r)[0],F={[v.priority]:ee,[v.chaos]:j,[v.randomized]:Y};var N=(...e)=>function*(){for(let t of e)yield*t()},_=(e,t=()=>!0)=>function*(){for(;t();)for(let r of e)yield*r()},H=e=>function*(){yield e};var z=({type:e,detail:t={}})=>({type:r,cb:n})=>n?n({detail:t,type:e}):e===r,q=({strategy:e=v.priority,dev:t}={})=>{let r=typeof e=="string"?F[e]:e,n=new Set,o=new Set,s=D();function c(){o.size&&a()}function a(){for(let p of o){let{generator:d,priority:y,thread:T,trigger:h}=p,{value:g,done:x}=d.next();!x&&n.add({thread:T,priority:y,...h&&{trigger:h},generator:d,...g}),o.delete(p)}i()}function i(){let p=[...n],d=[];for(let{request:g,priority:x}of p){if(Array.isArray(g)){d=d.concat(g.map(O=>({priority:x,...O})));continue}g&&d.push({priority:x,...g})}let y=p.flatMap(({block:g})=>g||[]),T=d.filter(g=>!y.some(z(g))),h=r(T);h&&(t&&s({kind:E.snapshot,data:k({bids:p,selectedEvent:h})}),l(h))}function l(p){for(let h of n){let{request:g=[],waitFor:x=[],generator:O}=h;[...Array.isArray(g)?g:[g],...Array.isArray(x)?x:[x]].some(z(p))&&O&&(o.add(h),n.delete(h))}let{priority:d,cb:y,...T}=p;s({kind:E.select,data:T}),c()}let u=({type:p,detail:d})=>{let y=function*(){yield{request:[{type:p,detail:d}],waitFor:[{type:"",cb:()=>!0}]}};o.add({thread:p,priority:0,trigger:!0,generator:y()}),c()},m=p=>{s.subscribe(({kind:d,data:y})=>{if(d===E.select){let{type:T,detail:h={}}=y;Object.hasOwn(p,T)&&p[T](h)}})},f=p=>{for(let d in p)o.add({thread:d,priority:o.size+1,generator:p[d]()})};return t&&s.subscribe(({kind:p,data:d})=>{p===E.snapshot&&t(d)}),Object.freeze({addThreads:f,feedback:m,trigger:u,loop:_,sync:H,thread:N})};var Ee=(...e)=>e.filter(Boolean).join(" ");var S=e=>Object.prototype.toString.call(e).slice(8,-1).toLowerCase();var te=/[&<>'"]/g;var re={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"};var{replace:ne}="",W=e=>ne.call(e,te,t=>re[t]);var B=e=>{let t=[...e].reduce((r,n)=>(r<<5)+r+n.charCodeAt(0),5381);return t===5381?null:t};var U=e=>{let t=/(^\w+|(?:\s)\w+)(?:->)/g;return[...e.matchAll(t)].flatMap(([,r])=>r)},V=(e,t)=>{let r=e.currentTarget===t||e.composedPath().find(c=>c?.tagName==="SLOT"&&c===t)?t:void 0;if(!r)return"";let n=`${e.type}->`,s=(r.dataset.trigger??"").trim().split(/\s+/).find(c=>c.includes(n));return s?s.replace(n,""):""},C=e=>!e.hasAttribute("slot")&&e.hasAttribute("name"),P=e=>e.replace(/(\s\s+|\n)/g," "),K=e=>S(e)==="string"||S(e)==="number",$=(e,...t)=>{let{raw:r}=e,n=t.reduce((o,s,c)=>{o+=P(r[c]);let a=Array.isArray(s)?s.filter(K).join(""):K(s)?s:"";return o.endsWith("$")&&(a=W(a),o=o.slice(0,-1)),o+a},"");return n+=P(r[r.length-1])};var se=e=>{let t=/\.(-?[_a-zA-Z]+[_a-zA-Z0-9-]*)/gm,r=[],n=0,o;for(;(o=t.exec(e))!==null;)o.index>n&&r.push(e.substring(n,o.index)),r.push({content:o[1]}),n=t.lastIndex;return n<e.length&&r.push(e.substring(n)),r},at=(e,...t)=>{let r=$(e,...t),n=btoa(`${B(r)}`).replace(/[+/=]/g,""),o=se(r),s=new Map,c=i=>{let l=`${i}_${n.slice(0,6)}`,u=`.${l}`;return s.has(i)||s.set(i,l),u},a=o?.map(i=>typeof i=="string"?P(i):c(i.content)).join("")||"";return{classes:Object.fromEntries(s),styles:P(a).trim()}};var lt=(e,t,r=!0)=>{let n=e.startsWith("var(")?e.substring(4,e.length-5):e,o;if(typeof t=="number"&&r){let s=parseInt(getComputedStyle(document.documentElement).fontSize);o=`${t/s}rem`}return t&&document.documentElement.style.setProperty(n,o||t.toString()),getComputedStyle(document.documentElement).getPropertyValue(n)};var L="data-target",b="data-trigger";var G=({id:e,connect:t,dev:r,strategy:n,context:o})=>{let{trigger:s,...c}=q({strategy:n,dev:r}),a;if(t){let i=o.tagName.toLowerCase(),l=o.id;e&&!l&&console.error(`island ${i} is missing an id attribute and cannot communicate with messenger`),a=t(e&&l?l:i,s),s({type:`connected->${e?l??`${i} with missing id`:i}`})}return{trigger:s,disconnect:a,...c}};var A=class{constructor(t){this.callback=t}handleEvent(t){this.callback(t)}},R=new WeakMap,M=Object.freeze({set:(e,t)=>{R.set(e,new A(t))},get:e=>R.get(e),has:e=>R.has(e)});var w=(e,...t)=>$(e,...t).trim().replace(/[\s\n]+>/g,">").replace(/(<.*?)(?:\s+)(\w)|>\s+</g,(o,s,c)=>s?[s,c].join(" "):"><").replace(/(>)(?:\s)(\S)|(\S)(?:\s)(<)/g,(o,s,c,a,i)=>s?[s,c].join(""):[a,i].join(""));var Z=e=>{let t=[];for(let r in e){let n=e[r];if(n!=null){if(r==="target"){t.push(`${L}="${n}"`);continue}if(r==="triggers"){t.push(`${b}="${Object.entries(n).map(([o,s])=>`${o}->${s}`).join(" ")}"`);continue}if(r==="className"){t.push(`class="${n}"`);continue}if(r==="htmlFor"){t.push(`for="${n}"`);continue}if(!(!r.startsWith("aria")&&!n)){if(!r.startsWith("aria")&&typeof n=="boolean"){t.push(w`$${r}`);continue}t.push(w`${r}="$${n?.toString()}"`)}}}return t.join(" ")};var oe=(e,t)=>Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every(r=>Object.hasOwn(t,r)&&e[r]===t[r]),X=e=>{let t=null;function r(n){if(t&&t.lastThis===this&&oe(n,t.lastProps))return t.lastResult;let o=e.call(this,n);return t={lastResult:o,lastProps:n,lastThis:this},o}return r.styles=new Set,r};var Rt=({mode:e="open",delegatesFocus:t=!0,tag:r,...n},o=s=>class extends s{})=>{let s=()=>{if(customElements.get(r)){console.error(`${r} already defined`);return}customElements.define(r,o(class extends HTMLElement{constructor(){super();this.internals_=this.attachInternals(),!this.internals_.shadowRoot&&this.attachShadow({mode:e,delegatesFocus:t})}#e;#t;#r;#n;connectedCallback(){if(!this.internals_.shadowRoot?.firstChild){let a=this.querySelector("template[shadowrootmode]");a?this.#o(a):this.#t=this.#a()}if(this.plait){this.internals_.shadowRoot&&this.#s(this.internals_.shadowRoot.querySelectorAll(`[${b}]`));let{disconnect:a,trigger:i,...l}=G({context:this,...n});this.plait({$:this.$.bind(this),context:this,trigger:i,...l}),this.#e=this.#i(),this.#r=a,this.#n=i}}disconnectedCallback(){this.#t&&this.#t.disconnect(),this.#e&&this.#e.disconnect(),this.#r&&(this.#n({type:`disconnected->${this.id||this.tagName.toLowerCase()}`}),this.#r())}#s(a){a.forEach(i=>{if(i.nodeType===1){if(i.tagName==="SLOT"&&!C(i))return;!M.has(i)&&M.set(i,u=>{let m=V(u,i);m?this.#n({type:m,detail:u}):i.removeEventListener(u.type,M.get(i))});let l=i.dataset.trigger;if(l){let u=U(l);for(let m of u)i.addEventListener(m,M.get(i))}}})}#i(){let a=new MutationObserver(i=>{for(let l of i)l.addedNodes.length&&this.#s(l.addedNodes),l.type==="attributes"&&this.internals_.shadowRoot&&this.#s(this.internals_.shadowRoot.querySelectorAll(`[${b}]`))});return this.internals_.shadowRoot&&a.observe(this.internals_.shadowRoot,{attributeFilter:[b],childList:!0,subtree:!0}),a}#o(a){this.internals_.shadowRoot&&(!this.internals_.shadowRoot.firstChild&&this.internals_.shadowRoot.appendChild(document.importNode(a.content,!0)),a.remove())}#a(){let a=new MutationObserver(()=>{let i=this.querySelector("template[shadowrootmode]");i&&(a.disconnect(),this.#o(i))});return a.observe(this,{childList:!0}),a}$(a){return this.internals_.shadowRoot?[...this.internals_.shadowRoot.querySelectorAll(`[${L}="${a}"]`)].filter(i=>i.tagName==="SLOT"?C(i):!0):[]}}))};return s.template=X(({styles:c,shadow:a,light:i,...l})=>{let u=c&&w`<style>${typeof c=="string"?c:[...c]}</style>`;return w`
  <${r} ${Z({...l})}>
    <template
      shadowrootmode="${e}"
      ${t&&"shadowrootdelegatesfocus"}
    >
      ${u}
      ${a}
    </template>
    ${i}
  </${r}>
  `}),s};var Dt=(...e)=>{let t=e.filter(Boolean),r={};Object.assign(r,...t);for(let n in r)r[`--${n}`]=r[n],delete r[n];return r};var J=(e,t)=>{let r=new Promise((n,o)=>{let s=indexedDB.open(e);s.onerror=()=>o(s.error),s.onsuccess=()=>n(s.result),s.onupgradeneeded=()=>{!s.result.objectStoreNames.contains(t)&&s.result.createObjectStore(t)}});return(n,o)=>r.then(s=>new Promise((c,a)=>{let i=s.transaction(t,n);i.oncomplete=()=>c(),i.onabort=i.onerror=()=>a(i.error),o(i.objectStore(t))}))};var _t=()=>{let e=new EventTarget;return Object.freeze({connect:(n,o)=>{let s=c=>o(c.detail);return e.addEventListener(n,s),()=>e.removeEventListener(n,s)},send:(n,o)=>{let s=new CustomEvent(n,{detail:o});e.dispatchEvent(s)}})};var Bt=async(e,t,r)=>{let n=r||J("USE_INDEXED_DB","STORE");await function(){return n("readwrite",l=>{l.put(t,e)})}();let o=i=>n("readwrite",l=>{let u=l.openCursor(e);u.onsuccess=function(){let f=this.result;if(f){let{value:p}=f;f.update(i(p));return}else console.error("cursor's value missing")}}),s=i=>n("readwrite",l=>l.put(i,e));return Object.freeze([()=>{let i;return n("readonly",l=>{i=l.get(e)}).then(()=>i.result)},i=>S(i)==="function"?o(i):s(i)])};var Ut=({context:e,trigger:t})=>{let r=({data:s})=>{t(s)},n=(s,c)=>{e.postMessage({recipient:s,detail:c})};return e.addEventListener("message",r,!1),Object.freeze({send:n,disconnect:()=>e.removeEventListener("message",r)})};var Zt=e=>{let t=e;return Object.freeze([()=>t,o=>{t=S(o)==="function"?o(t):o}])};var Jt=({id:e,url:t,connect:r,send:n})=>{let o=new Worker(new URL(t,import.meta.url).href,{type:"module"}),c=r(e,i=>{o.postMessage(i)}),a=({data:i})=>{let{recipient:l,detail:u}=i;n(l,u)};return o.addEventListener("message",a,!1),()=>{c(),o.removeEventListener("message",a)}};var Q=e=>{let t=e.attributes,r=t.length,n=new Map;for(let o=0;o<r;o++){let s=t[o];n.set(s.name,s.value)}return n},ie=(e,t)=>{let r=Q(t),n=Q(e);r.forEach((o,s)=>{if(n.has(s)){if(o===n.get(s)){n.delete(s);return}e.setAttribute(s,o)}}),n.forEach((o,s)=>{e.removeAttribute(s)})},I=(e,t)=>{let r=Array.prototype.slice.call(e.childNodes),n=r.length-t.length;if(n>0)for(;n>0;n--)r[r.length-n].remove();let o=t.length;for(let s=0;s<o;s++){let c=t[s],a=r[s];if(!a){e.appendChild(c.cloneNode(!0));continue}let i=c.nodeType;if(i!==a.nodeType){e.replaceChild(c.cloneNode(!0),a);continue}if(i===3||i===8){e.replaceChild(c.cloneNode(!0),a);continue}ie(a,c);let l=c.childNodes.length,u=a.childNodes.length;if(u>0&&l<1){a.replaceChildren();continue}let m=Array.prototype.slice.call(c.childNodes);if(u<1&&l>0){let f=document.createDocumentFragment();I(f,m),a.appendChild(f);continue}l>0&&I(a,m)}},Yt=(e,t,r)=>{let o=/^<(thead|tbody|tfoot|tr|th|td)/i.test(t)?"table":"div",s=new DOMParser().parseFromString(`<${o}>${t}</${o}>`,"text/html",{includeShadowRoots:!0});return r==="afterbegin"?e.prepend(...s.body.firstChild.childNodes):r==="beforeend"?e.append(...s.body.firstChild.childNodes):I(e,Array.prototype.slice.call(s.body.firstChild.childNodes))};export{q as bProgram,Ee as classNames,J as createIDB,at as css,lt as cssVar,w as html,Rt as isle,_ as loop,_t as messenger,Yt as render,H as sync,X as template,N as thread,Dt as tokens,Bt as useIndexedDB,Ut as useMain,Zt as useStore,Jt as useWebWorker,Z as wire};
