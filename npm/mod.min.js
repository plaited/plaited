var E={select:"select-event",snapshot:"state-snapshot"},v={randomized:"randomized",priority:"priority",chaos:"chaos",custom:"custom"};var C=({bids:e,selectedEvent:t})=>{let r=[];for(let n of e){let{generator:s,waitFor:i,block:c,request:a,thread:o,priority:l,trigger:u}=n,d={thread:o,priority:l},h;if(i&&Object.assign(d,{waitFor:Array.isArray(i)?i:[i]}),c&&Object.assign(d,{block:Array.isArray(c)?c:[c]}),a){let p=Array.isArray(a)?a:[a];p.some(({type:m})=>m===t.type&&l===t.priority)&&(h=t.type),Object.assign(d,{request:p})}r.push({...d,...u&&{trigger:u},...h&&{selected:h}})}return r.sort((n,s)=>n.priority-s.priority)};var A=()=>{let e=[];function t(r){for(let n in e)e[n](r)}return t.subscribe=r=>{e.push(n=>{n!==void 0&&r(n)})},t};var Q=e=>{for(let t=e.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e.sort(({priority:t},{priority:r})=>t-r)[0]},Y=e=>e[Math.floor(Math.random()*Math.floor(e.length))],j=e=>e.sort(({priority:t},{priority:r})=>t-r)[0],D={[v.priority]:j,[v.chaos]:Y,[v.randomized]:Q};var F=(...e)=>function*(){for(let t of e)yield*t()},_=(e,t=()=>!0)=>function*(){for(;t();)for(let r of e)yield*r()},z=e=>function*(){yield e};var H=({type:e,detail:t={}})=>({type:r,cb:n})=>n?n({detail:t,type:e}):e===r,q=({strategy:e=v.priority,dev:t}={})=>{let r=typeof e=="string"?D[e]:e,n=new Set,s=new Set,i=A();function c(){s.size&&a()}function a(){for(let p of s){let{generator:m,priority:y,thread:T,trigger:f}=p,{value:g,done:x}=m.next();!x&&n.add({thread:T,priority:y,...f&&{trigger:f},generator:m,...g}),s.delete(p)}o()}function o(){let p=[...n],m=[];for(let{request:g,priority:x}of p){if(Array.isArray(g)){m=m.concat(g.map(L=>({priority:x,...L})));continue}g&&m.push({priority:x,...g})}let y=p.flatMap(({block:g})=>g||[]),T=m.filter(g=>!y.some(H(g))),f=r(T);f&&(t&&i({kind:E.snapshot,data:C({bids:p,selectedEvent:f})}),l(f))}function l(p){for(let f of n){let{request:g=[],waitFor:x=[],generator:L}=f;[...Array.isArray(g)?g:[g],...Array.isArray(x)?x:[x]].some(H(p))&&L&&(s.add(f),n.delete(f))}let{priority:m,cb:y,...T}=p;i({kind:E.select,data:T}),c()}let u=({type:p,detail:m})=>{let y=function*(){yield{request:[{type:p,detail:m}],waitFor:[{type:"",cb:()=>!0}]}};s.add({thread:p,priority:0,trigger:!0,generator:y()}),c()},d=p=>{i.subscribe(({kind:m,data:y})=>{if(m===E.select){let{type:T,detail:f={}}=y;Object.hasOwn(p,T)&&p[T](f)}})},h=p=>{for(let m in p)s.add({thread:m,priority:s.size+1,generator:p[m]()})};return t&&i.subscribe(({kind:p,data:m})=>{p===E.snapshot&&t(m)}),Object.freeze({addThreads:h,feedback:d,trigger:u,loop:_,sync:z,thread:F})};var we=(...e)=>e.filter(Boolean).join(" ");var S=e=>Object.prototype.toString.call(e).slice(8,-1).toLowerCase();var W=()=>!!(typeof window<"u"&&window.document&&window.document.createElement);var ee=/[&<>'"]/g;var te={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"};var{replace:re}="",N=e=>re.call(e,ee,t=>te[t]);var B=e=>{let t=[...e].reduce((r,n)=>(r<<5)+r+n.charCodeAt(0),5381);return t===5381?null:t};var U=e=>{let t=/(^\w+|(?:\s)\w+)(?:->)/g;return[...e.matchAll(t)].flatMap(([,r])=>r)},V=(e,t)=>{let r=e.currentTarget===t||e.composedPath().find(c=>c?.tagName==="SLOT"&&c===t)?t:void 0;if(!r)return"";let n=`${e.type}->`,i=(r.dataset.trigger??"").trim().split(/\s+/).find(c=>c.includes(n));return i?i.replace(n,""):""},R=e=>!e.hasAttribute("slot")&&e.hasAttribute("name"),P=e=>e.replace(/(\s\s+|\n)/g," "),K=e=>S(e)==="string"||S(e)==="number",M=(e,...t)=>{let{raw:r}=e,n=t.reduce((s,i,c)=>{s+=P(r[c]);let a=Array.isArray(i)?i.filter(K).join(""):K(i)?i:"";return s.endsWith("$")&&(a=N(a),s=s.slice(0,-1)),s+a},"");return n+=P(r[r.length-1])};var ne=e=>{let t=/\.(-?[_a-zA-Z]+[_a-zA-Z0-9-]*)/gm,r=[],n=0,s;for(;(s=t.exec(e))!==null;)s.index>n&&r.push(e.substring(n,s.index)),r.push({content:s[1]}),n=t.lastIndex;return n<e.length&&r.push(e.substring(n)),r},ot=(e,...t)=>{let r=M(e,...t),n=btoa(`${B(r)}`).replace(/[+/=]/g,""),s=ne(r),i=new Map,c=o=>{let l=`${o}_${n.slice(0,6)}`,u=`.${l}`;return i.has(o)||i.set(o,l),u},a=s?.map(o=>typeof o=="string"?P(o):c(o.content)).join("")||"";return{classes:Object.fromEntries(i),styles:P(a).trim()}};var at=(e,t,r=!0)=>{let n=e.startsWith("var(")?e.substring(4,e.length-5):e,s;if(typeof t=="number"&&r){let i=parseInt(getComputedStyle(document.documentElement).fontSize);s=`${t/i}rem`}return t&&document.documentElement.style.setProperty(n,s||t.toString()),getComputedStyle(document.documentElement).getPropertyValue(n)};var $="data-target",w="data-trigger";var G=({id:e,connect:t,dev:r,strategy:n,context:s})=>{let{trigger:i,...c}=q({strategy:n,dev:r}),a;if(t){let o=s.tagName.toLowerCase(),l=s.id;e&&!l&&console.error(`island ${o} is missing an id attribute and cannot communicate with messenger`),a=t(e&&l?l:o,i),i({type:`connected->${e?l??`${o} with missing id`:o}`})}return{trigger:i,disconnect:a,...c}};var k=class{constructor(t){this.callback=t}handleEvent(t){this.callback(t)}},I=new WeakMap,O=Object.freeze({set:(e,t)=>{I.set(e,new k(t))},get:e=>I.get(e),has:e=>I.has(e)});var b=(e,...t)=>{let r=M(e,...t);return W()?r:r.trim().replace(/[\s\n]+>/g,">").replace(/(<.*?)(?:\s+)(\w)|>\s+</g,(n,s,i)=>s?[s,i].join(" "):"><").replace(/(>)(?:\s)(\S)|(\S)(?:\s)(<)/g,(n,s,i,c,a)=>s?[s,i].join(""):[c,a].join(""))};var Z=e=>{let t=[];for(let r in e){let n=e[r];if(n!=null){if(r==="target"){t.push(`${$}="${n}"`);continue}if(r==="triggers"){t.push(`${w}="${Object.entries(n).map(([s,i])=>`${s}->${i}`).join(" ")}"`);continue}if(r==="className"){t.push(`class="${n}"`);continue}if(r==="htmlFor"){t.push(`for="${n}"`);continue}if(!(!r.startsWith("aria")&&!n)){if(!r.startsWith("aria")&&typeof n=="boolean"){t.push(b`$${r}`);continue}t.push(b`${r}="$${n?.toString()}"`)}}}return t.join(" ")};var se=(e,t)=>Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every(r=>Object.hasOwn(t,r)&&e[r]===t[r]),X=e=>{let t=null;function r(n){if(t&&t.lastThis===this&&se(n,t.lastProps))return t.lastResult;let s=e.call(this,n);return t={lastResult:s,lastProps:n,lastThis:this},s}return r.styles=new Set,r};var Rt=({mode:e="open",delegatesFocus:t=!0,tag:r,...n},s=i=>class extends i{})=>{let i=()=>{if(customElements.get(r)){console.error(`${r} already defined`);return}customElements.define(r,s(class extends HTMLElement{constructor(){super();this.internals_=this.attachInternals(),!this.internals_.shadowRoot&&this.attachShadow({mode:e,delegatesFocus:t})}#e;#t;#r;#n;connectedCallback(){if(!this.internals_.shadowRoot?.firstChild){let a=this.querySelector("template[shadowrootmode]");a?this.#o(a):this.#t=this.#a()}if(this.plait){this.internals_.shadowRoot&&this.#s(this.internals_.shadowRoot.querySelectorAll(`[${w}]`));let{disconnect:a,trigger:o,...l}=G({context:this,...n});this.plait({$:this.$.bind(this),context:this,trigger:o,...l}),this.#e=this.#i(),this.#r=a,this.#n=o}}disconnectedCallback(){this.#t&&this.#t.disconnect(),this.#e&&this.#e.disconnect(),this.#r&&(this.#n({type:`disconnected->${this.id||this.tagName.toLowerCase()}`}),this.#r())}#s(a){a.forEach(o=>{if(o.nodeType===1){if(o.tagName==="SLOT"&&!R(o))return;!O.has(o)&&O.set(o,u=>{let d=V(u,o);d?this.#n({type:d,detail:u}):o.removeEventListener(u.type,O.get(o))});let l=o.dataset.trigger;if(l){let u=U(l);for(let d of u)o.addEventListener(d,O.get(o))}}})}#i(){let a=new MutationObserver(o=>{for(let l of o)l.addedNodes.length&&this.#s(l.addedNodes),l.type==="attributes"&&this.internals_.shadowRoot&&this.#s(this.internals_.shadowRoot.querySelectorAll(`[${w}]`))});return this.internals_.shadowRoot&&a.observe(this.internals_.shadowRoot,{attributeFilter:[w],childList:!0,subtree:!0}),a}#o(a){this.internals_.shadowRoot&&(!this.internals_.shadowRoot.firstChild&&this.internals_.shadowRoot.appendChild(document.importNode(a.content,!0)),a.remove())}#a(){let a=new MutationObserver(()=>{let o=this.querySelector("template[shadowrootmode]");o&&(a.disconnect(),this.#o(o))});return a.observe(this,{childList:!0}),a}$(a){return this.internals_.shadowRoot?[...this.internals_.shadowRoot.querySelectorAll(`[${$}="${a}"]`)].filter(o=>o.tagName==="SLOT"?R(o):!0):[]}}))};return i.template=X(({styles:c,shadow:a,light:o,...l})=>{let u=c&&b`<style>${typeof c=="string"?c:[...c]}</style>`;return b`
  <${r} ${Z({...l})}>
    <template
      shadowrootmode="${e}"
      ${t&&"shadowrootdelegatesfocus"}
    >
      ${u}
      ${a}
    </template>
    ${o}
  </${r}>
  `}),i};var At=(...e)=>{let t=e.filter(Boolean),r={};Object.assign(r,...t);for(let n in r)r[`--${n}`]=r[n],delete r[n];return r};var J=(e,t)=>{let r=new Promise((n,s)=>{let i=indexedDB.open(e);i.onerror=()=>s(i.error),i.onsuccess=()=>n(i.result),i.onupgradeneeded=()=>{!i.result.objectStoreNames.contains(t)&&i.result.createObjectStore(t)}});return(n,s)=>r.then(i=>new Promise((c,a)=>{let o=i.transaction(t,n);o.oncomplete=()=>c(),o.onabort=o.onerror=()=>a(o.error),s(o.objectStore(t))}))};var _t=()=>{let e=new EventTarget;return Object.freeze({connect:(n,s)=>{let i=c=>s(c.detail);return e.addEventListener(n,i),()=>e.removeEventListener(n,i)},send:(n,s)=>{let i=new CustomEvent(n,{detail:s});e.dispatchEvent(i)}})};var Nt=async(e,t,r)=>{let n=r||J("USE_INDEXED_DB","STORE");await function(){return n("readwrite",l=>{l.put(t,e)})}();let s=o=>n("readwrite",l=>{let u=l.openCursor(e);u.onsuccess=function(){let h=this.result;if(h){let{value:p}=h;h.update(o(p));return}else console.error("cursor's value missing")}}),i=o=>n("readwrite",l=>l.put(o,e));return Object.freeze([()=>{let o;return n("readonly",l=>{o=l.get(e)}).then(()=>o.result)},o=>S(o)==="function"?s(o):i(o)])};var Kt=({context:e,trigger:t})=>{let r=({data:i})=>{t(i)},n=(i,c)=>{e.postMessage({recipient:i,detail:c})};return e.addEventListener("message",r,!1),Object.freeze({send:n,disconnect:()=>e.removeEventListener("message",r)})};var Gt=e=>{let t=e;return Object.freeze([()=>t,s=>{t=S(s)==="function"?s(structuredClone(t)):s}])};var Xt=({id:e,url:t,connect:r,send:n})=>{let s=new Worker(new URL(t,import.meta.url).href,{type:"module"}),c=r(e,o=>{s.postMessage(o)}),a=({data:o})=>{let{recipient:l,detail:u}=o;n(l,u)};return s.addEventListener("message",a,!1),()=>{c(),s.removeEventListener("message",a)}};var Qt=(e,t,r)=>{let n=document.createElement("template");n.innerHTML=t;let s=n.content.cloneNode(!0);return r==="afterbegin"?e.prepend(s):(r==="beforeend"||e.replaceChildren(),e.append(s))};export{q as bProgram,we as classNames,J as createIDB,ot as css,at as cssVar,b as html,Rt as isle,_ as loop,_t as messenger,Qt as render,z as sync,X as template,F as thread,At as tokens,Nt as useIndexedDB,Kt as useMain,Gt as useStore,Xt as useWebWorker,Z as wire};
