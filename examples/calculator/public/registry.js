var x={objectObject:"object-object",objectPerson:"object-person",personPerson:"person-person"},m={trigger:"triggerEvent",select:"selectEvent",state:"stateSnapshot"};var L=({candidates:o,blocked:t,pending:e})=>{let r=[...new Set(e.filter(({strandName:i})=>i).map(({strandName:i,priority:c})=>({strandName:i,priority:c})))],s=[...new Set(t.map(({eventName:i})=>i).filter(Boolean))],n=[...new Set(o.map(({eventName:i,priority:c,payload:a})=>({eventName:i,priority:c,payload:a})))];return{streamEvent:m.state,logicStrands:r,requestedEvents:n,blockedEvents:s}};var O=o=>{let t=[];function e(r){for(let s in t)t[s](r)}return e.subscribe=r=>{let s=o!==void 0?r(o):void 0,n=O(s);return t.push(i=>{i!==void 0&&n(r(i))}),n},e};var k=o=>o.sort(({priority:t},{priority:e})=>t-e)[0];var l=class{static requestInParameter({eventName:t,payload:e}){return({eventName:r,callback:s})=>s?s({payload:e,eventName:t}):t===r}#n;#r=new Set;#t=new Set;#o={};stream;#e;constructor(t,{strategy:e=k,dev:r=!1}={}){this.#n=e,this.#e=r,this.stream=O(),this.trigger=this.trigger.bind(this),this.feedback=this.feedback.bind(this),this.add=this.add.bind(this),this.add(t)}#s(){this.#t.size&&this.#a()}#a(){for(let n of this.#t){let{logicStrand:i,priority:c,strandName:a}=n,{value:p,done:g}=i.next();!g&&this.#r.add({strandName:a,priority:c,logicStrand:i,...p}),this.#t.delete(n)}let t=[...this.#r],e=t.reduce((n,{request:i,priority:c})=>n.concat(i?i.map(a=>({priority:c,...a})):[]),[]),r=t.flatMap(({block:n})=>n||[]),s=e.filter(n=>!r.some(l.requestInParameter(n)));this.#o=this.#n(s),this.#e&&this.stream(L({candidates:e,blocked:r,pending:t})),this.#o&&this.#i()}#i(){for(let r of this.#r){let{request:s=[],waitFor:n=[],logicStrand:i}=r;[...s,...n].some(l.requestInParameter(this.#o))&&i&&(this.#t.add(r),this.#r.delete(r))}let{eventName:t,payload:e}=this.#o;this.stream({streamEvent:m.select,eventName:t,payload:e}),this.#s()}trigger({eventName:t,payload:e,baseDynamic:r}){let s=function*(){yield{request:[{eventName:t,payload:e}],waitFor:[{eventName:"",callback:()=>!0}]}};this.#t.add({strandName:`Trigger(${t})`,priority:0,logicStrand:s()}),this.#e&&this.stream({streamEvent:m.trigger,baseDynamic:r,eventName:`Trigger(${t})`,payload:e}),this.#s()}feedback(t){return this.stream.subscribe(({streamEvent:e,...r})=>{if(e!==m.select)return;let{eventName:s,payload:n}=r;t[s]&&t[s](n)})}add(t){for(let e in t)this.#t.add({strandName:e,priority:this.#t.size+1,logicStrand:t[e]()})}};var C=o=>(...t)=>({[o]:[...t]}),y=C("waitFor"),nt=C("block"),b=(...o)=>({request:[...o]});var w=(o,t=()=>!0)=>function*(){for(;t();)yield*o()},v=(...o)=>function*(){for(let t of o)yield t};var S="data-target",h="data-trigger";var d=o=>Object.prototype.toString.call(o).slice(8,-1).toLowerCase();var U=/[&<>'"]/g;var K={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"};var{replace:_}="",D=o=>_.call(o,U,t=>K[t]);var q=o=>{};var I=o=>{let t=o;return Object.freeze([()=>t,s=>{t=d(s)==="function"?s(t):s}])};var P=o=>o.replace(/(\s\s+|\n)/g," "),R=o=>d(o)==="string"||d(o)==="number",u=(o,...t)=>{let{raw:e}=o,r=t.reduce((n,i,c)=>{n+=P(e[c]);let a=Array.isArray(i)?i.filter(R).join(""):R(i)?i:"";return n.endsWith("$")&&(a=D(a),n=n.slice(0,-1)),n+a},"");return r+=P(e[e.length-1]),r.trim().replace(/[\s\n]+>/g,">").replace(/(<.*?)(?:\s+)(\w)|>\s+</g,(n,i,c)=>i?[i,c].join(" "):"><").replace(/(>)(?:\s)(\S)|(\S)(?:\s)(<)/g,(n,i,c,a,p)=>i?[i,c].join(""):[a,p].join(""))};var j=o=>{let t=[];for(let e in o){let r=o[e];if(r!=null){if(e==="target"){t.push(`${S}="${r}"`);continue}if(e==="triggers"){t.push(`${h}="${Object.entries(r).map(([s,n])=>`${s}->${n}`).join(" ")}"`);continue}if(e==="className"){t.push(`class="${r}"`);continue}if(e==="htmlFor"){t.push(`for="${r}"`);continue}if(!(!e.startsWith("aria")&&!r)){if(!e.startsWith("aria")&&typeof r=="boolean"){t.push(u`$${e}`);continue}t.push(u`${e}="$${r?.toString()}"`)}}}return t.join(" ")};var A=(o,t)=>Object.keys(o).length===Object.keys(t).length&&Object.keys(o).every(e=>t.hasOwnProperty(e)&&o[e]===t[e]),W=o=>{let t=null;function e(r){if(t&&t.lastThis===this&&A(r,t.lastProps))return t.lastResult;let s=o.call(this,r);return t={lastResult:s,lastProps:r,lastThis:this},s}return e.stylesheets=new Set,e};var se=W(({tag:o,template:t,mode:e="open",stylesheets:r,...s})=>u`
<${o} ${j({...s})}>
  <template shadowroot="${e}">
    ${r&&u`<style>${[...r]}</style>`}
    ${t}
  </template>
</${o}>
`);var N=class{callback;constructor(t){this.callback=t}handleEvent(t){this.callback(t)}},T=new WeakMap,$=Object.freeze({set:(o,t)=>{T.set(o,new N(t))},get:o=>T.get(o),has:o=>T.has(o)});var f=({strands:o={},actions:t={},id:e,connect:r,context:s,logger:n,strategy:i}={})=>{let{feedback:c,trigger:a,stream:p}=new l(o,{strategy:i,dev:Boolean(n)});n&&p.subscribe(n),c(t);let g=q;if(r&&s){let F=e||s.tagName.toLowerCase();g=r(e||s.tagName.toLowerCase(),a),a({eventName:`connected->${F}`})}return{trigger:a,disconnect:g}};var Q=o=>{let t=/(^\w+|(?:\s)\w+)(?:->)/g;return[...o.matchAll(t)].flatMap(([,e])=>e)},B=o=>{let t=o.currentTarget,r=`${o.type}->`;return t.dataset.trigger.trim().split(/\s+/).find(s=>s.includes(r)).replace(r,"")},X=o=>{let t=[];return o.forEach(e=>{e instanceof HTMLElement&&e.dataset.trigger&&t.push(e)}),t},E=(o,t)=>{customElements.get(o)||customElements.define(o,t(class extends HTMLElement{#n=!1;#r;#t;#o;internals_;#e;constructor(e,r){super(),this.internals_=this.attachInternals(),this.internals_.shadowRoot||(this.attachShadow({mode:e||"open",delegatesFocus:r}),this.#n=!0),this.$=this.$.bind(this)}connectedCallback(){if(this.#n){let s=this.querySelector("template[shadowroot]");s?this.#i(s):this.#t=this.#c()}this.#s(),this.#r=this.#a();let{disconnect:e,trigger:r}=this.plait(this.$,this);this.#o=e,this.#e=r,this.#e({eventName:`connected->${this.id||this.tagName.toLowerCase()}`,baseDynamic:x.objectObject})}plait(e,r){return f({})}disconnectedCallback(){this.#e({eventName:`disconnected->${this.id||this.tagName.toLowerCase()}`,baseDynamic:x.objectObject}),this.#t&&this.#t.disconnect(),this.#r.disconnect(),this.#o()}#s(e){(e||this.shadowRoot.querySelectorAll(`[${h}]`)).forEach(s=>{$.has(s)||$.set(s,i=>{let c=B(i);c&&this.#e({eventName:c,payload:i,baseDynamic:x.objectPerson})});let n=Q(s.dataset.trigger);for(let i of n)s.addEventListener(i,$.get(s))})}#a(){let e=new MutationObserver(r=>{for(let s of r)s.addedNodes.length&&this.#s(X(s.addedNodes)),s.type==="attributes"&&this.#s()});return e.observe(this,{attributeFilter:[h],childList:!0,subtree:!0}),e}#i(e){let r=this.shadowRoot;!r.firstChild&&r.appendChild(document.importNode(e.content,!0))}#c(){let e=new MutationObserver(()=>{let r=this.querySelector("template[shadowroot]");r&&(e.disconnect(),this.#i(r))});return e.observe(this,{childList:!0}),e}$(e){return[...this.shadowRoot.querySelectorAll(`[${S}="${e}"]`)]}static define(e){customElements.get(e)||customElements.define(e,this)}}))};var z=()=>{let o=new EventTarget;return Object.freeze({connect:(r,s)=>{let n=i=>s(i.detail);return o.addEventListener(r,n),()=>o.removeEventListener(r,n)},send:(r,s)=>{let n=new CustomEvent(r,{detail:s});o.dispatchEvent(n)}})};var{connect:H,send:M}=z();window.streamLog=[];E("key-pad",o=>class extends o{plait(){return f({actions:{number(r){let s=r.currentTarget?.value;M("value-display",{eventName:`addNumber-${s}`,payload:s})},clear(){M("value-display",{eventName:"clear"})}},logger:r=>{window.streamLog.push(r)}})}});E("value-display",o=>class extends o{plait(t,e){let[r,s]=I([]),n={onClear:w(v(y({eventName:"clear"}),b({eventName:"clearDisplay"}))),...[...Array(10).keys()].reduce((a,p)=>(Object.assign(a,{[`onClick:${p}`]:w(v(y({eventName:`addNumber-${p}`}),b({eventName:"updateNumber",payload:p})))}),a),{}),onLog:w(v(y({eventName:"logMe"}),b({eventName:"logSelf"})))},i=(a,p)=>{a.replaceChildren(`${p[3]||0}${p[2]||0}:${p[1]||0}${p[0]||0}`)};return f({context:e,actions:{updateNumber(a){r.length<5&&s([...r(),a]);let[p]=t("display");i(p,r())},clearDisplay(){let[a]=t("display");a.replaceChildren("00:00"),s([])},logSelf(){console.log("hit")}},strands:n,connect:H})}});
//# sourceMappingURL=registry.js.map
