services:
  dev:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        TZ: ${TZ:-America/Los_Angeles}
        CLAUDE_CODE_VERSION: ${CLAUDE_CODE_VERSION:-latest}
    volumes:
      # Persist Claude authentication across container restarts
      - ${HOME}/.claude:/home/bun/.claude
      # Mount project directory
      - .:/workspace
      # Persist command history
      - command-history:/commandhistory
    working_dir: /workspace
    user: bun
    # Required for iptables/firewall functionality
    cap_add:
      - NET_ADMIN
      - NET_RAW
    stdin_open: true
    tty: true
    environment:
      - TZ=${TZ:-America/Los_Angeles}
    command: zsh

volumes:
  command-history:
    driver: local
