# Dockerfile for integration tests requiring Docker environment
# Uses same bun version as CI for consistency
#
# Tests use *.docker.ts naming to:
# 1. Avoid bun test pattern matching in normal test runs
# 2. Signal these tests require Docker (sqlite-vec, external APIs, etc.)

FROM oven/bun:1.2.9

# Install git (required by prepare script in package.json)
RUN apt-get update && apt-get install -y git && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Copy source (includes .git for prepare script)
COPY . .

# Install dependencies (sqlite-vec native bindings work on Linux)
RUN bun install --frozen-lockfile

# Run all Docker integration tests
# The wrapper script handles finding and running *.docker.ts files
CMD ["bash", "scripts/bun-test-wrapper.sh"]
